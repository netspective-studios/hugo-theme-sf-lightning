{{ $productId  := $.Scratch.Get "productId" }} 
{{ $productName  := $.Scratch.Get "productName" }} 
{{ $tenantId  := $.Scratch.Get "tenantId" }} 
{{ $.Scratch.Add  "i"  20 }}
{{ range .Site.Data.offering_cadd_questions_lhc_form.items }}
{{ $.Scratch.Add "i" 1 }}
{{ $i:= $.Scratch.Get "i" }}
{{ $.Scratch.Set "itemClassValue"  "" }}
{{ range $key, $value := .prefix }} 
  {{ if eq $key "itemClass" }} 
  {{ $.Scratch.Set "itemClassValue"  $value }}
  {{ end }}
{{ end }}
{{ $itemClassValue:= $.Scratch.Get "itemClassValue" }} 
{{ if eq $itemClassValue "offering-share-migration-decision" }}
  <div class="accordion" id="accordionid{{$i}}">
    <div class="card">
      <div class="card-header" id="heading{{$i}}">
        <h2 class="mb-0">
          <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapse{{$i}}" aria-expanded="false" aria-controls="collapseOne">
          <i class="{{ range $key, $value := .prefix }} {{ if eq $key "iconClass" }} {{ print  $value }} {{ end }} {{ end }}"></i>
          <span id="offeringQuestion{{.questionCode}}" >{{.question}}</span> <i class="fa fa-chevron-up right-icon"></i>
          </button>
        </h2>
      </div>
      <div id="collapse{{$i}}" class="collapse" aria-labelledby="heading{{$i}}" data-parent="#accordionid{{$i}}" style="">
        <div class="card-body">
          <div class="new-ofering-row-5">
            <div id="migrationMsg{{.questionCode}}" class="alert alert-success" style="display: none;"></div>           
              <div class="row otherAlternative">                   
                <div class="col-md-3 mt-2 mb-1" id="off_name" >
                  <input  placeholder="{{ range .items | first 1 }}{{ .question}}{{ end}}" name="nameTextMigration{{.questionCode}}" id="nameTextMigration{{.questionCode}}" class="form-control" />
                </div>
                <div class="col-lg-1 col-md-2 mt-2 mb-1">URL</div>
                <div class="col-md-3 mt-2 mb-1" id="off_url" >
                  <input  name="urlTextMigration{{.questionCode}}" id="urlTextMigration{{.questionCode}}" class="form-control" />
                  <span id="validurlTextMigration{{.questionCode}}" class="errorCustomMessage">Please enter a valid website link.</span>
                </div>
                <div class="col-md-12 mt-2 mb-1">{{ range .items | last 1 }}{{ .question}}{{ end}}
                  <textarea class="form-control" name="descriptionTextMigration{{.questionCode}}" id="descriptionTextMigration{{.questionCode}}"rows="2" cols="50" ></textarea>					                 
                </div>	                   
                <div class="col-md-4 mt-2 mb-1">
                  <input type="submit" value="Submit" id="btn_{{.questionCode}}" class="btn btn-primary q-btn-1" data-metric="{{ .localQuestionCode}}" data-name="{{ $productName }}" data-id="{{ $productId }}" style="display:none"> 
                </div>
              </div>
            <div id="collectionDiv{{ .questionCode }}" class="pt-4"></div>
            <div class="clearfix"></div>
          </div>
        </div>
      </div>
    </div>
  </div>  
  <script>
    var offeringName = "{{ $productName}}";
    var replacedString = $("#offeringQuestion{{.questionCode}}").text().replace("offeringName", offeringName);
    $("#offeringQuestion{{.questionCode}}").text(replacedString);

    $('#urlTextMigration{{.questionCode}}').on('focusout', function (e) {
      if (is_url($('#urlTextMigration{{.questionCode}}').val()))     
        $('#validurlTextMigration{{.questionCode}}').hide();       
      else     
        $('#validurlTextMigration{{.questionCode}}').show();       
    });
    $('#nameTextMigration{{.questionCode}}').keyup(function(){
        if ($('#nameTextMigration{{.questionCode}}').val() != "" && $('#nameTextMigration{{.questionCode}}').val() != null)
          $('#btn_{{.questionCode}}').show();
        else
        $('#btn_{{.questionCode}}').hide();
    });

    /// Push internal data starts here ////
      $("#btn_{{.questionCode}}").on("click", function (e) { 
        e.preventDefault();
        if ($(this).hasClass("checked")) { 
          console.log('exists'); return false;
        }
        else {
          var personid = getCookie('personid');
          if (getCookie('personid') != null  && getCookie('sessionId')!= null && getCookie('sessionId')!= '' ) { 
            var productId ="{{ $productId }}";
            var productName = "{{ $productName }}";
            var source = "Attest-"+productId;
            var decisionOver = $('#nameTextMigration{{.questionCode}}').val();
            var decisionUrl = $('#urlTextMigration{{.questionCode}}').val();
            var description = $('#descriptionTextMigration{{.questionCode}}').val();
            metricName = "medigy_qual_exp_"+$(this).attr('data-metric');
            if(validateFunction(decisionOver)==true || validateFunction(decisionUrl)==true || validateFunction(description)==true || is_url(decisionUrl)== false)  {
              alert("Please fill the fields properly");
              return false;
            }  

            var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "POST", "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"offeringId\", \n        value: \"{{ $productId }}\"\n      }, \n      {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"decisionOver\", \n        value: \""+decisionOver+"\"\n      }, \n      {\n        key: \"decisionUrl\", \n        value: \""+decisionUrl+"\"\n      }, \n      {\n        key: \"description\", \n        value: \""+description+"\"\n      }, \n      {\n        key: \"userId\", \n        value: \""+personid+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+metricName+"\", \n    metricName: \""+metricName+"\") {\n    status\n    message\n    errorCode\n  }\n}" };
            ajaxPageServiceCall.serviceCall(serviceData).then(response => {
              if(response.data.addPrometheusData.status == "SUCCESS"){
                  $('#migrationMsg{{.questionCode}}').html("");
                  var collection = '';
                  $('#migrationMsg{{.questionCode}}').removeClass('alert-danger');
                  $('#migrationMsg{{.questionCode}}').addClass('alert-success');
                  collection += '<div class="new-ofering-row-5-cell-1-list col-md-12 mb-1 mt-2">'; 
                  collection += '<div class="">' + '<i class="fas fa-caret-right"></i> '+description+'</div> '; 
                  collection += '<div class="clearfix"></div>';
                  collection += '</div>';        
                  $("#collectionDiv{{ .questionCode}}").append(collection);
                  $('#migrationMsg{{.questionCode}}').append("Successfully added your submission.");
                  $('#migrationMsg{{.questionCode}}').show();
                  $('#btn_{{.questionCode}}').hide(); 
                  $('#nameTextMigration{{.questionCode}}').val("");
                  $('#urlTextMigration{{.questionCode}}').val("");
                  $('#descriptionTextMigration{{.questionCode}}').val("");
              }
              $('#migrationMsg{{.questionCode}}').fadeOut(8000);
            })
                .catch(error => {
                    console.log(error);
                });

          }
          else{
            if (getCookie('personid') == null)
            $('#loginModalCenter').modal('toggle');
            else
            $('#reLoginModalCenter').modal('toggle');
          }             
        }
      });
    /// Push internal data ends here ////

    function is_url(str) {
      regexp = /^(?:(?:https?):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/;
      if (regexp.test(str)) {

        return true;
      }
      else
        return false;
    }
    function validateFunction(string) {
      let isEmpty=true;
      var alphabet = 'abcdefghijklmnopqrstuvwxyz0123456789'.split('');
      alphabet.forEach((key,val)=>{
            if(string.indexOf(key) > -1) isEmpty=false;
          });
      
      return isEmpty;
    }

      var metricName = "medigy_qual_exp_{{.localQuestionCode}}";
      var decision_list ="";
      var productId = "{{ $productId }}";
      var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "GET", "query": "query{\n  getPromData(metricName:\""+metricName+"\",metricQuery:\"{offeringId=\\\""+productId+"\\\"}[1y]\",groupByParam:[\"userId\"]){\n    prometheusData\n    status\n  }\n}" };
      ajaxPageServiceCall.serviceCall(serviceData).then(response => {
        if(response.data.getPromData.status == "success"){
          var JSONData = JSON.parse(response.data.getPromData.prometheusData);
          var collection = [];
          for(var i = 0; i < JSONData.length; i++) {
          var obj = JSONData[i];   
          collection.push({id:obj.offeringId,description:obj.description});
          }
          if(JSONData.length > 0){                    
            var descriptionlist="";
            for(j = 0; j < (collection.length); j++)
            {
              descriptionlist += '<div class="new-ofering-row-5-cell-1-list col-md-12 mb-1 mt-2">';    
              descriptionlist += '<div class="">'+ '<i class="fas fa-caret-right"></i> ' +collection[j]["description"]+'</div> '; 
              descriptionlist += '<div class="clearfix"></div>';
              descriptionlist += '</div>';
            }
            $('#collectionDiv{{ .questionCode }}').html(descriptionlist);                   
          }
        }
      })
        .catch(error => {
            console.log(error);
        });        

  </script>
{{ end }}
{{ if eq $itemClassValue "offering-share-alternative-decision"}}
  <div class="accordion" id="accordion{{$i}}">
    <div class="card">
      <div class="card-header" id="heading{{$i}}">
        <h2 class="mb-0">
          <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapse{{$i}}" aria-expanded="false" aria-controls="collapseOne">
              <i class="{{ range $key, $value := .prefix }} {{ if eq $key "iconClass" }} {{ print  $value }} {{ end }} {{ end }}"></i><span id="offeringQuestion{{.questionCode}}" >{{.question}}</span>
              <div class="arrow_box_addOffering arrow_box_category_addOffering" id="categoryInfoMessageBox"> You can choose multiple elements by Ctrl or Shift clicking items</div>   
              <span class="label-optional">(Optional)</span>
              <i class="fa fa-chevron-up right-icon"></i>
          </button>
        </h2>
      </div>
      <div id="collapse{{$i}}" class="collapse" aria-labelledby="heading{{$i}}" data-parent="#accordion{{$i}}" style="">
        <div class="card-body">
          <div class="new-ofering-row-5">
            <div id="decsionMsg{{.questionCode}}" class="alert alert-success" style="display: none;"></div>
              <div class="row">
                <div class="col-md-4 mt-2  mb-1">
                  <select class="form-control" name="suggest-offering-list-{{.questionCode}}" id="suggest-offering-list-{{.questionCode}}"  title="Please select the best suited alternative for your offering">
                  </select>
                </div>
                <div class="col-md-4 mt-2  mb-1">
                  <input type="submit" value="Submit" id="submit_btn_{{.questionCode}}" class="btn btn-primary q-btn-1" data-name="{{ $productName }}" data-metric="{{ .localQuestionCode }}" data-id="{{ $productId }}" style="display:none"> 
                </div>
                <div class="clearfix"></div>
              </div>						
              <div class="row otherAlternative">
                <div class="col-md-3 mt-2 mb-1">Add Others</div>
                <div class="col-md-3 mt-2 mb-1" id="alternateTitleTextId{{ .questionCode}}" ><input  placeholder="Enter the Title" name="alternateTitleTextId{{ .questionCode}}" id="alternateTitleTextName{{ .questionCode}}" class="form-control" /></div>
                <div class="col-md-3 mt-2 mb-1" id="alternateUrlTextName{{ .questionCode}}" >
                  <input  placeholder="Enter the URL" name="alternateUrlTextName{{ .questionCode}}" id="alternateUrlTextId{{ .questionCode}}" class="form-control" />
                  <span id="validalternateUrlTextName{{ .questionCode}}" class="errorCustomMessage">Please enter a valid website link.</span>
                </div>						
                <div class="col-md-4 mt-2 mb-1">
                  <input type="submit" value="Submit" id="submit_btn_others_{{.questionCode}}" class="btn btn-primary q-btn-1" data-name="{{ $productName }}" data-metric="{{ .localQuestionCode }}" data-id="{{ $productId }}" style="display:none"> 
                </div>
              </div>           
              <div id="decsionCollectionDiv{{.questionCode}}" class="pt-4 split-row"></div>
              <div class="clearfix"></div>
            </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    /// Retrieve the offerings list from json starts

    var serviceData = { "url": "/offering/index.json", "method": "GET", "query": "" };
      ajaxPageServiceCall.serviceCall(serviceData).then(response => {
        var JSONData = response.data; 
          JSONData.sort(function(a, b){
          var x = a.title.toLowerCase().replace(/^\s+/g, ''), y = b.title.toLowerCase().replace(/^\s+/g, '');
          return x < y ? -1 : x > y ? 1 : 0;
          })
          var catOption = '';
          catOption += '<option value="0">Please select</option>';
          for(var i = 0; i < JSONData.length; i++) {
            var label = JSONData[i]["title"];
            var key = JSONData[i]["id"];
            var type = JSONData[i]["offeringType"];
            var url = JSONData[i]["offeringUrl"];
            catOption += '<option data-type="' + type + '" data-url="' + url + '" value="' + key + '">' + label + '</option>';              
          }    
          $('#suggest-offering-list-{{.questionCode}}').html(catOption);
          $("#suggest-offering-list-{{.questionCode}} option[value='{{ $productId}}']").remove();
          $("#suggest-offering-list-{{.questionCode}} option[value='<no value>']").remove();
        })
        .catch(error => {
            console.log(error);
        }); 


    /// Retrieve the offerings list from json ends

    /// Push internal offering suggestion data starts here ///
      $("#submit_btn_{{.questionCode}}").on("click", function (e) { 
        e.preventDefault();
        if ($(this).hasClass("checked")) { 
          console.log('exists'); return false;
        }
        else {
          var personid = getCookie('personid');
          if (getCookie('personid') != null  && getCookie('sessionId')!= null && getCookie('sessionId')!= '' ) { 
            var productId ="{{ $productId }}";
            var productName = "{{ $productName }}";
            var source = "Attest-"+productId;
            var suggOfferingId = $('#suggest-offering-list-{{.questionCode}}').val();
            var metricNameInternal ="medigy_qual_exp_"+$(this).attr('data-metric');
            var suggOfferingName = $("#suggest-offering-list-{{.questionCode}}").find(':selected').html();     
            var othersuggestion = $('#alternateTitleTextName{{ .questionCode}}').val();
            var offeringType = $("#suggest-offering-list-{{.questionCode}}").find(':selected').attr('data-type'); 
            var offeringUrl = $("#suggest-offering-list-{{.questionCode}}").find(':selected').attr('data-url');
            var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "POST", "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"offeringId\", \n        value: \"{{ $productId }}\"\n      }, \n      {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"suggOfferingUrl\", \n        value: \""+offeringUrl+"\"\n      }, \n      {\n        key: \"offeringName\", \n        value: \"{{ $productName }}\"\n      }, \n      {\n        key: \"suggOfferingId\", \n        value: \""+suggOfferingId+"\"\n      }, \n      {\n        key: \"suggOfferingName\", \n        value: \""+suggOfferingName+"\"\n      }, \n      {\n        key: \"userId\", \n        value: \""+personid+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+metricNameInternal+"\", \n    metricName: \""+metricNameInternal+"\") {\n    status\n    message\n    errorCode\n  }\n}" };
            console.log("mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"offeringId\", \n        value: \"{{ $productId }}\"\n      }, \n      {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"suggOfferingUrl\", \n        value: \""+offeringUrl+"\"\n      }, \n      {\n        key: \"offeringName\", \n        value: \"{{ $productName }}\"\n      }, \n      {\n        key: \"suggOfferingId\", \n        value: \""+suggOfferingId+"\"\n      }, \n      {\n        key: \"suggOfferingName\", \n        value: \""+suggOfferingName+"\"\n      }, \n      {\n        key: \"userId\", \n        value: \""+personid+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+metricNameInternal+"\", \n    metricName: \""+metricNameInternal+"\") {\n    status\n    message\n    errorCode\n  }\n}" );
            ajaxPageServiceCall.serviceCall(serviceData).then(response => {
              if(response.data.addPrometheusData.status == "SUCCESS"){

                $("#suggest-offering-list-{{.questionCode}} option[value='"+ suggOfferingId+ "']").remove();
                $('#decsionMsg{{.questionCode}}').html("");
                var collection = '';
                $('#decsionMsg{{.questionCode}}').removeClass('alert-danger');
                $('#decsionMsg{{.questionCode}}').addClass('alert-success');
                collection += '<div class="new-ofering-row-5-cell-1-list">';
                collection += '<div class="new-ofering-row-5-cell-1-list-right">' +suggOfferingName+'</div> ';                                    
                collection += '<div class="new-ofering-row-5-cell-1-list-right"><a target="_blank" href="'+offeringUrl+'">'+offeringUrl+'</a></div> '; 
                collection += '<a class="suggestionUpvote-{{.questionCode}}" style="pointer-events:none" href="#"><div class="new-ofering-row-5-cell-1-list-left"><span class="arrow"><i class="fas fa-sort-up"></i></span> <span class="number">'+'1'+'</span></div></a>';                
                collection += '<div class="clearfix"></div>';
                collection += '</div>';    
                $("#decsionCollectionDiv{{.questionCode}}").append(collection);
                $('#decsionMsg{{.questionCode}}').append("Successfully added a "+offeringType+".");
                $('#decsionMsg{{.questionCode}}').show();
                $('#submit_btn_{{.questionCode}}').hide(); 
                $('#alternateTitleTextId{{ .questionCode}}').val("");
                $('#alternateTitleTextName{{ .questionCode}}').val("");
                $('#alternateUrlTextId{{ .questionCode}}').val("");
                $('#alternateUrlTextName{{ .questionCode}}').val("");
                $("#suggest-offering-list-{{.questionCode}}").val("");                 
              }
              $('#decsionMsg{{.questionCode}}').fadeOut(8000);
            })
        .catch(error => {
            console.log(error);
        });             
            

          }
          else{
            if (getCookie('personid') == null)
            $('#loginModalCenter').modal('toggle');
            else
            $('#reLoginModalCenter').modal('toggle');
          }           
        }
      });
    /// Push internal offering suggestion data ends here ///

    /// Get data starts here 
    setTimeout(function(){
      var sugg_offer_list ="";
      var productId = "{{ $productId }}";
      var metricNameInternal ="medigy_qual_exp_{{.localQuestionCode}}";
      var metricNameExternal ="medigy_qual_exp_others_{{.localQuestionCode}}";
      var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "GET", "query": "query{\n  getPromData(metricName:\""+metricNameInternal+"\",metricQuery:\"{offeringId=\\\""+productId+"\\\"}[1y]\",groupByParam:[\"userId\",\"suggOfferingId\"]){\n    prometheusData\n    status\n  }\n}" };
      ajaxPageServiceCall.serviceCall(serviceData).then(sourceResponse => {       
        if(sourceResponse.data.getPromData.status == "success"){
            var JSONData = JSON.parse(sourceResponse.data.getPromData.prometheusData);
            var userArray = JSONData.filter(function (el) {
                    return el.userId == getCookie('personid')
                  });
            var tmp = [];
            tmp = JSONData;       
            for(j =0; j<(JSONData.length);j++){
              var count = 0;
              for(i =0; i< (tmp.length);i++){
                    if(JSONData[j]['suggOfferingId'] == JSONData[i]['suggOfferingId'])            
                      count++;
                }  
                JSONData[j]['count'] = count;           
            }   
            if(JSONData.length > 0){
              var obj = {};
              for ( var i = 0, len = JSONData.length; i < len; i++ ){
                if(!obj[JSONData[i]["suggOfferingId"]]) 
                obj[JSONData[i]["suggOfferingId"]] = JSONData[i];
              }
              var newArr = [];
              for ( var key in obj ) newArr.push(obj[key]);

              for(j = 0; j < (newArr.length); j++){
                var styleconst = "";
                for(var i=0; i<userArray.length; i++){		
                    if (userArray[i].suggOfferingId == newArr[j]["suggOfferingId"])	                           
                      var styleconst = 'style="pointer-events: none;"';      				
                } 
                sugg_offer_list += '<div class="new-ofering-row-5-cell-1-list">';
                sugg_offer_list += '<div class="new-ofering-row-5-cell-1-list-right">'+newArr[j]["suggOfferingName"]+'</div> '; 
                sugg_offer_list += '<div class="new-ofering-row-5-cell-1-list-right"><a target="_blank" href="'+newArr[j]["suggOfferingUrl"]+'">'+newArr[j]["suggOfferingUrl"]+'</a></div> '; 
                sugg_offer_list += '<a id="suggestionUpvote" class="suggestionUpvote-{{.questionCode}}"'+ styleconst + 'data-title="'+newArr[j]["suggOfferingName"]+'" data-metric="'+metricNameInternal+'" data-id="'+newArr[j]["suggOfferingId"]+'" data-url="'+newArr[j]["suggOfferingUrl"]+'" data-type="internal" href="JavaScript:Void(0);"><div class="new-ofering-row-5-cell-1-list-left"><span class="arrow"><i class="fas fa-sort-up"></i></span> <span class="number">'+newArr[j]["count"]+'</span></div></a>';      
                sugg_offer_list += '<div class="clearfix"></div>';
                sugg_offer_list += '</div>';
              }
              $('#decsionCollectionDiv{{.questionCode}}').html(sugg_offer_list);                   
            }
            /// fetching others (external offerings) info on page load starts
              var sugg_offer_otherslist ="";
              //console.log("query{\n  getPromData(metricName:\""+metricNameExternal+"\",metricQuery:\"{offeringId=\\\""+productId+"\\\"}[1y]\",groupByParam:[\"userId\",\"otherTitle\"]){\n    prometheusData\n    status\n  }\n}" );
              var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "GET", "query": "query{\n  getPromData(metricName:\""+metricNameExternal+"\",metricQuery:\"{offeringId=\\\""+productId+"\\\"}[1y]\",groupByParam:[\"userId\",\"otherTitle\"]){\n    prometheusData\n    status\n  }\n}" };
              ajaxPageServiceCall.serviceCall(serviceData).then(sourceResponse => {
                if(sourceResponse.data.getPromData.status == "success"){
                  var JSONData = JSON.parse(sourceResponse.data.getPromData.prometheusData);
                  var userArray = JSONData.filter(function (el) {
                  return el.userId == getCookie('personid')
                  });
                  var tmp = [];
                  tmp = JSONData;       
                  for(j =0; j<(JSONData.length);j++){
                    var count = 0;
                    for(i =0; i< (tmp.length);i++){
                      if(JSONData[j]['otherTitle'] == JSONData[i]['otherTitle'])            
                        count++;
                    }  
                      JSONData[j]['count'] = count;           
                  }   
                  if(JSONData.length > 0){
                    var obj = {};
                    for ( var i = 0, len = JSONData.length; i < len; i++ ){
                      if(!obj[JSONData[i]["otherTitle"]]) 
                      obj[JSONData[i]["otherTitle"]] = JSONData[i];
                    }
                    var newArr = [];
                    for ( var key in obj ) newArr.push(obj[key]);

                    for(j = 0; j < (newArr.length); j++){
                      var styleconst = "";
                      for(var i=0; i<userArray.length; i++){		
                          if (userArray[i].otherTitle == newArr[j]["otherTitle"])	                           
                            var styleconst = 'style="pointer-events: none;"';      				
                      }           
                      sugg_offer_otherslist += '<div class="new-ofering-row-5-cell-1-list">';
                      sugg_offer_otherslist += '<div class="new-ofering-row-5-cell-1-list-right">'+newArr[j]["otherTitle"]+'</div> '; 
                      sugg_offer_otherslist += '<div class="new-ofering-row-5-cell-1-list-right"><a target="_blank" href="'+newArr[j]["suggOfferingUrl"]+'">'+newArr[j]["suggOfferingUrl"]+'</a></div> ';
                      sugg_offer_otherslist += '<a id="suggestionUpvote" class="suggestionUpvote-{{.questionCode}}"' + styleconst +'data-title="'+newArr[j]["otherTitle"]+'" data-metric="'+metricNameExternal+'" data-id="'+newArr[j]["otherTitle"]+'" data-type="external"  data-url="'+newArr[j]["suggOfferingUrl"]+'" href="JavaScript:Void(0);"><div class="new-ofering-row-5-cell-1-list-left"><span class="arrow"><i class="fas fa-sort-up"></i></span> <span class="number">'+newArr[j]["count"]+'</span></div></a>';      
                      sugg_offer_otherslist += '<div class="clearfix"></div>';
                      sugg_offer_otherslist += '</div>';
                    }
                    $('#decsionCollectionDiv{{.questionCode}}').append(sugg_offer_otherslist);                        
                  } 
                }
              })
                .catch(error => {
                    console.log(error);
                });

            /// fetching others (external offerings) info on page load ends
          }

      })
        .catch(error => {
            console.log(error);
        });   
      },1000)

          

    var offeringName = "{{ $productName}}";
    var replacedString = $("#offeringQuestion{{.questionCode}}").text().replace("offeringName", offeringName);
    $("#offeringQuestion{{.questionCode}}").text(replacedString);
    $('#alternateUrlTextId{{ .questionCode}}').on('focusout', function (e) {
          if (is_url($('#alternateUrlTextId{{ .questionCode}}').val())) {      
            $('#validalternateUrlTextName{{ .questionCode}}').hide();       
          }
          else {      
            $('#validalternateUrlTextName{{ .questionCode}}').show();       
          }
    });
    $('#suggest-offering-list-{{.questionCode}}').change(function(){
        if ($('#suggest-offering-list-{{.questionCode}}').val() == "0" || $('#suggest-offering-list-{{.questionCode}}').val() == "others") {
          $('#submit_btn_{{.questionCode}}').hide();
          if ($('#suggest-offering-list-{{.questionCode}}').val() == "others")
            $('#alternateTitleTextId{{ .questionCode}}').show();
        } 
        else{
            $('#submit_btn_{{.questionCode}}').show();
        }   
    });
    $('#alternateTitleTextId{{ .questionCode}}').keyup(function(){
      if ($('#suggest-offering-list-{{.questionCode}}').val() != "")
        $('#submit_btn_others_{{.questionCode}}').show();
      else
        $('#submit_btn_others_{{.questionCode}}').hide();
    });
    /// Push external data starts here ////
      $("#submit_btn_others_{{.questionCode}}").on("click", function (e) { 
        e.preventDefault();
        if ($(this).hasClass("checked")) { 
          console.log('exists'); return false;
        }
        else {
          var personid = getCookie('personid');
          if ( is_url($('#alternateUrlTextId{{ .questionCode}}').val())==true && getCookie('personid') != null  && getCookie('sessionId')!= null && getCookie('sessionId')!= '' ) { 
            var productId ="{{ $productId }}";
            var productName = "{{ $productName }}";
            var source = "Attest-"+productId;
            var suggOfferingId = $('#suggest-offering-list-{{.questionCode}}').val();  
            var suggOfferingName = $("#suggest-offering-list-{{.questionCode}}").find(':selected').html();       
            var othersuggtitle = $('#alternateTitleTextName{{ .questionCode}}').val();
            var othersuggurl = $('#alternateUrlTextId{{ .questionCode}}').val();         
            var metricNameExternal ="medigy_qual_exp_others_"+$(this).attr('data-metric');
            if(othersuggurl != "" && othersuggtitle !=""){
              console.log("mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"offeringId\", \n        value: \""+productId+"\"\n      }, \n      {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"suggOfferingUrl\", \n        value: \""+othersuggurl+"\"\n      }, \n      {\n        key: \"offeringName\", \n        value: \""+productName+"\"\n      }, \n      {\n        key: \"suggOfferingId\", \n        value: \""+suggOfferingId+"\"\n      }, \n      {\n        key: \"otherTitle\", \n        value: \""+othersuggtitle+"\"\n      }, \n      {\n        key: \"othersuggurl\", \n        value: \""+othersuggurl+"\"\n      }, \n      {\n        key: \"userId\", \n        value: \""+personid+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+metricNameExternal+"\", \n    metricName: \""+metricNameExternal+"\") {\n    status\n    message\n    errorCode\n  }\n}" );
              var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "POST", "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"offeringId\", \n        value: \""+productId+"\"\n      }, \n      {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"suggOfferingUrl\", \n        value: \""+othersuggurl+"\"\n      }, \n      {\n        key: \"offeringName\", \n        value: \""+productName+"\"\n      }, \n      {\n        key: \"suggOfferingId\", \n        value: \""+suggOfferingId+"\"\n      }, \n      {\n        key: \"otherTitle\", \n        value: \""+othersuggtitle+"\"\n      }, \n      {\n        key: \"othersuggurl\", \n        value: \""+othersuggurl+"\"\n      }, \n      {\n        key: \"userId\", \n        value: \""+personid+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+metricNameExternal+"\", \n    metricName: \""+metricNameExternal+"\") {\n    status\n    message\n    errorCode\n  }\n}" };
              ajaxPageServiceCall.serviceCall(serviceData).then(response => {
                if(response.data.addPrometheusData.status == "SUCCESS"){
                  $('#decsionMsg{{.questionCode}}').html("");
                  var collection = '';
                  $('#decsionMsg{{.questionCode}}').removeClass('alert-danger');
                  $('#decsionMsg{{.questionCode}}').addClass('alert-success');
                  collection += '<div class="new-ofering-row-5-cell-1-list">';
                  collection += '<div class="new-ofering-row-5-cell-1-list-right">' +othersuggtitle+'</div> ';                 
                  collection += '<div class="new-ofering-row-5-cell-1-list-right"><a target="_blank" href="'+othersuggurl+'">'+othersuggurl+'</a></div> '; 
                  collection += '<a class="suggestionUpvote-{{.questionCode}}" style="pointer-events:none" href="#"><div class="new-ofering-row-5-cell-1-list-left"><span class="arrow"><i class="fas fa-sort-up"></i></span> <span class="number">'+'1'+'</span></div></a>';
                  
                  collection += '<div class="clearfix"></div>';
                  collection += '</div>';    

                  $("#decsionCollectionDiv{{.questionCode}}").append(collection);
                  $('#decsionMsg{{.questionCode}}').append("Successfully added an alternative.");
                  $('#decsionMsg{{.questionCode}}').show();
                  $('#submit_btn_{{.questionCode}}').hide(); 
                  $('#submit_btn_others_{{.questionCode}}').hide(); 

                  $('#alternateTitleTextId{{ .questionCode}}').val("");
                  $('#alternateTitleTextName{{ .questionCode}}').val("");
                  $('#alternateUrlTextId{{ .questionCode}}').val("");
                  $('#alternateUrlTextName{{ .questionCode}}').val("");									
              }
                  $('#decsionMsg{{.questionCode}}').fadeOut(8000);
              })
              .catch(error => {
                  console.log(error);
              }); 

            }else{
              if(othersuggurl == "")        
              alert("Please fill up the offering reference link.");
              else
              alert("Please fill up the offering title.");
            }
          }
          else{
            if (getCookie('personid') == null)
              $('#loginModalCenter').modal('toggle');
            else if(is_url($('#alternateUrlTextId{{ .questionCode}}').val())==false)
              $('.validLinkGitalternateUrlTextName{{ .questionCode}}').show();  
            else
              $('#reLoginModalCenter').modal('toggle');
          }           
        }
      });
    /// Push external data ends here ////

    /// Upvote functionality starts
      $('body').on('click', '.suggestionUpvote-{{.questionCode}}', function (e) {
        e.preventDefault();
        if ($(this).hasClass("checked")) { 
              console.log('exists'); return false;
        }
        var suggOfferingName = $(this).attr("data-title"); 
        var suggOfferingId = $(this).attr("data-id");
        var productId = "{{ $productId}}";
        var productName = "{{ $productName}}";
        var personid = getCookie('personid');
        var source = "Attest-"+productId;
        var type = $(this).attr("data-type"); 
        var url = $(this).attr("data-url"); 
        var currentUpvote = $(this).find(".number").html();
        var this_var = $(this);
        var metricNameInternal =$(this).attr('data-metric');
        var metricNameExternal =$(this).attr('data-metric');
        if(personid != null){
            $(this).addClass("checked");
            // case 1 - push internal alternative upvote starts
              if(suggOfferingName !="" && type =="internal"){  
              console.log("mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"offeringId\", \n        value: \""+productId+"\"\n      }, \n      {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"suggOfferingUrl\", \n        value: \""+url+"\"\n      }, \n      {\n        key: \"offeringName\", \n        value: \""+productName+"\"\n      }, \n      {\n        key: \"suggOfferingId\", \n        value: \""+suggOfferingId+"\"\n      }, \n      {\n        key: \"suggOfferingName\", \n        value: \""+suggOfferingName+"\"\n      }, \n      {\n        key: \"userId\", \n        value: \""+personid+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+metricNameInternal+"\", \n    metricName: \""+metricNameInternal+"\") {\n    status\n    message\n    errorCode\n  }\n}");
              var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "POST", "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"offeringId\", \n        value: \""+productId+"\"\n      }, \n      {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"suggOfferingUrl\", \n        value: \""+url+"\"\n      }, \n      {\n        key: \"offeringName\", \n        value: \""+productName+"\"\n      }, \n      {\n        key: \"suggOfferingId\", \n        value: \""+suggOfferingId+"\"\n      }, \n      {\n        key: \"suggOfferingName\", \n        value: \""+suggOfferingName+"\"\n      }, \n      {\n        key: \"userId\", \n        value: \""+personid+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+metricNameInternal+"\", \n    metricName: \""+metricNameInternal+"\") {\n    status\n    message\n    errorCode\n  }\n}" };
              ajaxPageServiceCall.serviceCall(serviceData).then(response => {
                if(response.data.addPrometheusData.status == "SUCCESS"){
                      currentUpvote++;
                      this_var.find(".number").html(currentUpvote);
                  }                
              })
              .catch(error => {
                  console.log(error);
              });                 

              }
            // case 1 - push internal alternative upvote ends              
            // case 2 - push external alternative upvote starts

              if(suggOfferingName !="" && type =="external"){   

                var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "POST", "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"offeringId\", \n        value: \""+productId+"\"\n      }, \n      {\n        key: \"offeringName\", \n        value: \""+productName+"\"\n      }, \n      {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"suggOfferingId\", \n        value: \""+suggOfferingId+"\"\n      }, \n      {\n        key: \"suggOfferingUrl\", \n        value: \""+url+"\"\n      }, \n      {\n        key: \"otherTitle\", \n        value: \""+suggOfferingId+"\"\n      }, \n      {\n        key: \"userId\", \n        value: \""+personid+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+metricNameExternal+"\", \n    metricName: \""+metricNameExternal+"\") {\n    status\n    message\n    errorCode\n  }\n}" };
              ajaxPageServiceCall.serviceCall(serviceData).then(response => {
                if(response.data.addPrometheusData.status == "SUCCESS"){
                    currentUpvote++;
                    this_var.find(".number").html(currentUpvote);
                  }
              })
              .catch(error => {
                  console.log(error);
              }); 


              }
            //case 2 - push external alternative upvote ends
          }
        else
          $('#loginModalCenter').modal('toggle');
      });
    /// Upvote functionality ends
    function is_url(str) {
      regexp = /^(?:(?:https?):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/;
      if (regexp.test(str)) {

        return true;
      }
      else
        return false;
    }
  </script>
{{ end }}
{{ if eq $itemClassValue "pros-cons-offering-name" }}        
  <div class="accordion" id="accordion{{$i}}">
    <div class="card">
      <div class="card-header" id="heading{{$i}}">
        <h2 class="mb-0">
          <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapse{{$i}}" aria-expanded="false" aria-controls="collapseOne">
            <i class="{{ range $key, $value := .prefix }} {{ if eq $key "iconClass" }} {{ print  $value }} {{ end }} {{ end }}"></i> 
            <span id="offeringQuestion{{.questionCode}}" >{{.question}}</span>
            <i class="fa fa-chevron-up right-icon"></i>
          </button>
        </h2>
      </div>
      <div id="collapse{{$i}}" class="collapse" aria-labelledby="heading{{$i}}" data-parent="#accordion{{$i}}" style="">
        <div class="card-body">		            			
          <div class="new-ofering-row-5-cell-1 row ml-0">
            {{ range .items | first 1 }}
            {{ $.Scratch.Set "firstSubQuestionCode"  .localQuestionCode }}
            {{ end }}
            {{ range .items | last 1 }}
            {{ $.Scratch.Set "secondSubQuestionCode"  .localQuestionCode }}
            {{ end }}
            {{ $firstSubQuestionCode:= $.Scratch.Get "firstSubQuestionCode" }}
            {{ $secondSubQuestionCode:= $.Scratch.Get "secondSubQuestionCode" }}
            {{ range .items }}    
              <div class="col-lg-6">							
                <div class="new-ofering-row-5-cell-1-col-1">
                  <h4><span id="subQuestion-{{ .localQuestionCode }}">{{.question}}<span></h4>
                  <div id="{{.localQuestionCode}}CollectionDiv"></div>                    
                </div>				  
                <div id="{{.localQuestionCode}}Message" class="alert alert-success" style="display: none;"></div>
                <div class="form-group row">
                  <label for="email" class="">Add New</label>
                  <div class="w-100 mr-4">
                    <input name="{{.localQuestionCode}}Title" id="{{.localQuestionCode}}Title" class="form-control" />
                  </div>
                </div>
                <div class="text-left row">
                  <input type="submit" value="Add New" data-btn-identifier="{{.localQuestionCode}}" id="{{.localQuestionCode}}Button" class="btn btn-primary" productName="{{ $productName }}" productId="{{ $productId }}" style="display:none">
                </div>		  
              </div>
            {{ end }}
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    /// Item Push data starts here ////
      $('#{{$firstSubQuestionCode}}Button, #{{$secondSubQuestionCode}}Button').on("click", function (e) {
        e.preventDefault();
        if ($(this).attr('disabled')) {
          console.log('exists'); return false;
        }
        else {        
          var productName = $(this).attr('productName');
          var itemIdentifierCode = $(this).attr('data-btn-identifier');
          if (getCookie('personid') != null  && getCookie('sessionId')!= null && getCookie('sessionId')!= '' ) { 
            $('#'+itemIdentifierCode+'Button').prop("disabled", true);
            var productId = $(this).attr('productid');
            var source = "Attest-"+productId;
            var personId = getCookie('personid');
            var metricName = "medigy_qual_exp_"+itemIdentifierCode;
            var itemTitle = $('#'+itemIdentifierCode+'Title').val();
            var timestamp = Date.now();

            var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "POST", "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"offeringId\", \n        value: \""+productId+"\"\n      }, \n     {\n        key: \"itemTitle\", \n        value: \""+itemTitle+"\"\n      }, \n      {\n        key: \"createdat\", \n        value: \""+timestamp+"\"\n      }, \n     {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"offeringName\", \n        value: \""+productName+"\"\n      }, \n      {\n        key: \"userId\", \n        value: \""+personId+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+metricName+"\", \n    metricName: \""+metricName+"\") {\n    status\n    message\n    errorCode\n  }\n}" };
              ajaxPageServiceCall.serviceCall(serviceData).then(response => {
                if(response.data.addPrometheusData.status == "SUCCESS"){
                $('#'+itemIdentifierCode+'Message').html("");
                var itemCollection = '';
                $('#'+itemIdentifierCode+'Message').removeClass('alert-danger');
                $('#'+itemIdentifierCode+'Message').addClass('alert-success');
                itemCollection += '<div class="new-ofering-row-5-cell-1-list">';
                itemCollection += '<div class="new-ofering-row-5-cell-1-list-left"><span class="arrow"><i class="fas fa-sort-up"></i></span> <span class="number">1</span></div>';  
                itemCollection += '<div class="new-ofering-row-5-cell-1-list-right">'+itemTitle+'</div> '; 
                itemCollection += '<div class="clearfix"></div>';
                itemCollection += '</div>';
                $('#'+itemIdentifierCode+'CollectionDiv').append(itemCollection);            
                $('#'+itemIdentifierCode+'Message').html("Successfully submitted.");
                $('#'+itemIdentifierCode+'Title').val('');
                $('#'+itemIdentifierCode+'Message').show();
                $('#'+itemIdentifierCode+'Button').prop("disabled", false);
              }
              else{
                $('#'+itemIdentifierCode+'Message').html("");
                $('#'+itemIdentifierCode+'Message').removeClass('alert-success');
                $('#'+itemIdentifierCode+'Message').addClass('alert-danger');
                $('#'+itemIdentifierCode+'Message').html("Filed to create.");
                $('#'+itemIdentifierCode+'Message').show();      
                $('#'+itemIdentifierCode+'Button').prop("disabled", false);      
              }
                $('#'+itemIdentifierCode+'Message').fadeOut(8000); 
              })
              .catch(error => {
                  console.log(error);
              });                 

          }
          else{
            if (getCookie('personid') == null)
              $('#loginModalCenter').modal('toggle');
            else
              $('#reLoginModalCenter').modal('toggle');
          }
        }
      });
    /// Item Push data ends here ////

    /// Pros (First Item) Get data starts here ////
        var itemlist="";
        var productId = "{{ $productId }}";
        var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "POST", "query": "query{\n  getPromData(metricName:\"medigy_qual_exp_{{$firstSubQuestionCode}}\",metricQuery:\"{offeringId=\\\""+productId+"\\\"}[2y]\"){\n    prometheusData\n    status\n  }\n}" };
        ajaxPageServiceCall.serviceCall(serviceData).then(itemResponse => {
          if(itemResponse.data.getPromData.status == "success"){
            var JSONData = JSON.parse(itemResponse.data.getPromData.prometheusData);
            var userArray = JSONData.filter(function (el) {
            return el.userId == getCookie('personid')
            });
            var tmpconsCollection = [];
            tmpconsCollection = JSONData;       
            for(j =0; j<(JSONData.length);j++){
              var count = 0;
              for(i =0; i< (tmpconsCollection.length);i++){
                if(JSONData[j]['itemTitle'] == JSONData[i]['itemTitle'])  
                  count++;
              }  
              JSONData[j]['count'] = count;           
            }
            if(JSONData.length > 0){                    
              var obj = {};
              for ( var i = 0, len = JSONData.length; i < len; i++ ){
                if(!obj[JSONData[i]["itemTitle"]]) obj[JSONData[i]["itemTitle"]] = JSONData[i];
              }
              var newArr = [];
              for ( var key in obj ) newArr.push(obj[key]); 
              for(j = 0; j < (newArr.length); j++){

                var styleconst = "";
                for(var i=0; i<userArray.length; i++){		
                  if (userArray[i].itemTitle == newArr[j]["itemTitle"])	                           
                    var styleconst = 'style="pointer-events: none;"';      				
                }
                itemlist += '<div class="new-ofering-row-5-cell-1-list">';
                itemlist += '<a id="{{$firstSubQuestionCode}}Vote" ' + styleconst +' data-btn-identifier="{{$firstSubQuestionCode}}" class="upvote-subquestion-code"  href="JavaScript:Void(0);" data-title="'+newArr[j]["itemTitle"]+'"><div class="new-ofering-row-5-cell-1-list-left"><span class="arrow"><i class="fas fa-sort-up"></i></span> <span class="number">'+newArr[j]["count"]+'</span></div></a>';  
                itemlist += '<div class="new-ofering-row-5-cell-1-list-right">'+newArr[j]["itemTitle"]+'</div> '; 
                itemlist += '<div class="clearfix"></div>';
                itemlist += '</div>';
              }
              $('#{{$firstSubQuestionCode}}CollectionDiv').html(itemlist);         
            }
          }
        })
        .catch(error => {
            console.log(error);
        });  


    /// Pros (First Item) Get data ends here ////

    /// Cons (Second Item) Get data starts here ////
        var itemList="";
        var productId = "{{ $productId }}";

        var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "GET", "query": "query{\n  getPromData(metricName:\"medigy_qual_exp_{{$secondSubQuestionCode}}\",metricQuery:\"{offeringId=\\\""+productId+"\\\"}[2y]\"){\n    prometheusData\n    status\n  }\n}" };
        ajaxPageServiceCall.serviceCall(serviceData).then(response => {
          if(response.data.getPromData.status == "success"){
            var JSONData = JSON.parse(response.data.getPromData.prometheusData);
            var userArray = JSONData.filter(function (el) {
            return el.userId == getCookie('personid')
            });
            var tmpconsCollection = [];
            tmpconsCollection = JSONData;       
            for(j =0; j<(JSONData.length);j++){
              var count = 0;
              for(i =0; i< (tmpconsCollection.length);i++){
              if(JSONData[j]['itemTitle'] == JSONData[i]['itemTitle'])  
                count++;
              }  
              JSONData[j]['count'] = count;           
            }
            if(JSONData.length > 0){                    
              var obj = {};
              for ( var i = 0, len = JSONData.length; i < len; i++ ){
                if(!obj[JSONData[i]["itemTitle"]]) obj[JSONData[i]["itemTitle"]] = JSONData[i];
              }
              var newArr = [];
              for ( var key in obj ) newArr.push(obj[key]); 
              for(j = 0; j < (newArr.length); j++){
                var styleconst = "";
                for(var i=0; i<userArray.length; i++){		
                  if (userArray[i].itemTitle == newArr[j]["itemTitle"])	                           
                    var styleconst = 'style="pointer-events: none;"';      				
                }
                itemList += '<div class="new-ofering-row-5-cell-1-list">';
                itemList += '<a id="{{$secondSubQuestionCode}}Vote"'+styleconst+' data-btn-identifier="{{$secondSubQuestionCode}}" class="upvote-subquestion-code"  href="JavaScript:Void(0);" data-title="'+newArr[j]["itemTitle"]+'"><div class="new-ofering-row-5-cell-1-list-left"><span class="arrow"><i class="fas fa-sort-up"></i></span> <span class="number">'+newArr[j]["count"]+'</span></div></a>';  
                itemList += '<div class="new-ofering-row-5-cell-1-list-right">'+newArr[j]["itemTitle"]+'</div> '; 
                itemList += '<div class="clearfix"></div>';
                itemList += '</div>';
              }
                $('#{{$secondSubQuestionCode}}CollectionDiv').html(itemList);  
            }
          }
        })
        .catch(error => {
            console.log(error);
        });          

    /// Cons (Second Item) Get data ends here ////

    /// upvote (pros/cons) pushing starts
      $('body').on('click', '.upvote-subquestion-code', function (e) {
        e.preventDefault();
        if ($(this).hasClass("checked")) { 
              console.log('exists'); return false;
        }
        var itemTitle = $(this).attr("data-title"); 
        var itemIdentifierCode = $(this).attr('data-btn-identifier');
        var metricName = "medigy_qual_exp_"+itemIdentifierCode;
        var productId = "{{ $productId}}";
        var productName = "{{ $productName}}";
        var source = "Attest-"+productId;
        var personId = getCookie('personid');
        var currentUpvote = $(this).find(".number").html();
        var timestamp = Date.now();
        var this_var = $(this);   
        if (getCookie('personid') != null  && getCookie('sessionId')!= null && getCookie('sessionId')!= '' ) { 
          $(this).addClass("checked");
          if(itemTitle !=""){         
            var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "POST", "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"offeringId\", \n        value: \""+productId+"\"\n      }, \n     {\n        key: \"itemTitle\", \n        value: \""+itemTitle+"\"\n      }, \n     {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"createdat\", \n        value: \""+timestamp+"\"\n      }, \n      {\n        key: \"offeringName\", \n        value: \""+productName+"\"\n      }, \n      {\n        key: \"userId\", \n        value: \""+personId+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+metricName+"\", \n    metricName: \""+metricName+"\") {\n    status\n    message\n    errorCode\n  }\n}" };
            ajaxPageServiceCall.serviceCall(serviceData).then(response => {
              if(response.data.addPrometheusData.status == "SUCCESS")          
                currentUpvote++;                                
                this_var.find(".number").html(currentUpvote); 
              })
              .catch(error => {
                  console.log(error);
              });

          } 
        }  
        else{
          if (getCookie('personid') == null)
            $('#loginModalCenter').modal('toggle');
          else
            $('#reLoginModalCenter').modal('toggle');
        }
      });
    /// upvote (pros/cons) pushing ends

    var offeringName = "{{ $productName}}";
    var replacedString = $("#offeringQuestion{{.questionCode}}").text().replace("offeringName", offeringName);
    $("#offeringQuestion{{.questionCode}}").text(replacedString);
    var replacedString = $("#subQuestion-{{ $firstSubQuestionCode }}").text().replace("offeringName", offeringName);
    $("#subQuestion-{{ $firstSubQuestionCode}}").text(replacedString);
    var replacedString = $("#subQuestion-{{ $secondSubQuestionCode }}").text().replace("offeringName", offeringName);
    $("#subQuestion-{{ $secondSubQuestionCode }}").text(replacedString);  
    $('#{{ $secondSubQuestionCode }}Title').keyup(function(){
      ($('#{{ $secondSubQuestionCode }}Title').val()!= '') ? $('#{{ $secondSubQuestionCode }}Button').show() : $('#{{ $secondSubQuestionCode }}Button').hide();
    });
    $('#{{ $firstSubQuestionCode}}Title').keyup(function(){
      ($('#{{ $firstSubQuestionCode}}Title').val()!= '') ? $('#{{ $firstSubQuestionCode }}Button').show() : $('#{{ $firstSubQuestionCode }}Button').hide();       
    });

  </script>
{{ end}}
{{ if eq $itemClassValue "questions-asked-about-offering" }}
  <div class="accordion" id="accordion{{$i}}">
    <div class="card">
      <div class="card-header" id="heading{{$i}}">
        <h2 class="mb-0">
          <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapse{{$i}}" aria-expanded="false" aria-controls="collapseOne">
            <i class="{{ range $key, $value := .prefix }} {{ if eq $key "iconClass" }} {{ print  $value }} {{ end }} {{ end }}"></i><span id="offeringQuestion{{.questionCode}}" >{{.question}}</span>
            <i class="fa fa-chevron-up right-icon"></i>
          </button>
        </h2>
      </div>
      <div id="collapse{{$i}}" class="collapse" aria-labelledby="heading{{$i}}" data-parent="#accordion{{$i}}" style="">
        <div class="card-body">
          <div class="new-ofering-row-5-cell-1 row ml-0">
            <div class="new-ofering-row-5 mb-3 w-100">                            
              <div id="questionMessage{{.questionCode}}" class="alert alert-success" style="display: none;"></div>
              <div class="form-group row">									  
                <div class="col-sm-6">
                  <label for="email" class="">Add new Question</label>  
                  <input class="form-control" placeholder="Have a question?" name="questionTitle{{.questionCode}}" id="questionTitle{{.questionCode}}"/>
                </div>
              </div>
              <div class="text-left">
                <input type="submit" value="Add New" id="questionButton{{.questionCode}}" class="btn btn-primary q-btn-1" data-metric="{{.localQuestionCode}}" productname="{{ $productName }}" productid="{{ $productId }}" style="display:none">
              </div>             
            </div>  
            <div id="questionCollectionDiv{{.questionCode}}"></div>		  
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    $('#questionButton{{.questionCode}}').on("click", function (e) {
      e.preventDefault();
      if ($(this).attr('disabled')) {
        console.log('exists'); return false;
      }
      else {        
        var productName = $(this).attr('productname');
        metricName = "medigy_qual_exp_"+$(this).attr('data-metric');
        var r = confirm("Do you want to ask a question about the offering '" + productName +"'.");
        if (r == true) {
          if (getCookie('personid') != null  && getCookie('sessionId')!= null && getCookie('sessionId')!= '' ) {
            $('#questionButton{{.questionCode}}').prop("disabled", true);
            var timestamp = Date.now();
            var productId = $(this).attr('productid');
            var source = "Attest-"+productId;
            var personId = getCookie('personid');
            var questionTitle = $('#questionTitle{{.questionCode}}').val();
            var dt = new Date();
            var questionId = dt.getDate() + "-" + (dt.getMonth()+1) + "-" + dt.getFullYear() + "-" + dt.getHours() + "-" + dt.getMinutes() + "-" + dt.getSeconds();
            //console.log("mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"offeringId\", \n        value: \""+productId+"\"\n     }, \n      {\n        key: \"questionTitle\", \n        value: \""+questionTitle+"\"\n      }, \n      {\n        key: \"createdat\", \n        value: \""+timestamp+"\"\n      }, \n      {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"questionId\", \n        value: \""+questionId+"\"\n      }, \n     {\n        key: \"userId\", \n        value: \""+personId+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+metricName+"\", \n    metricName: \""+metricName+"\") {\n    status\n    message\n    errorCode\n  }\n}");
            var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "POST", "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"offeringId\", \n        value: \""+productId+"\"\n     }, \n      {\n        key: \"questionTitle\", \n        value: \""+questionTitle+"\"\n      }, \n      {\n        key: \"createdat\", \n        value: \""+timestamp+"\"\n      }, \n      {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"questionId\", \n        value: \""+questionId+"\"\n      }, \n     {\n        key: \"userId\", \n        value: \""+personId+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+metricName+"\", \n    metricName: \""+metricName+"\") {\n    status\n    message\n    errorCode\n  }\n}" };
            ajaxPageServiceCall.serviceCall(serviceData).then(response => {
              if(response.data.addPrometheusData.status == "SUCCESS"){
              $('#questionMessage{{.questionCode}}').html("");
              var questionCollection = '';
              $('#questionMessage{{.questionCode}}').removeClass('alert-danger');
              $('#questionMessage{{.questionCode}}').addClass('alert-success');
              questionCollection += '<div class="new-ofering-row-5-cell-1-list col-md-12 mb-1 mt-2">'; 
              questionCollection += '<div class="">' + '<i class="fas fa-caret-right"></i> '+questionTitle+'</div> '; 
              questionCollection += '<div class="clearfix"></div>';
              questionCollection += '</div>';
              $("#questionCollectionDiv{{.questionCode}}").append(questionCollection);
              $('#questionMessage{{.questionCode}}').append("Question successfully submitted.");
              $('#questionTitle{{.questionCode}}').val('');
              $('#questionMessage{{.questionCode}}').show();
              $('#questionButton{{.questionCode}}').prop("disabled", false);
              // To show updated count next to button
              var currentQuestioncount = $('#gitAskQuestion').html();
              updatedcount = (currentQuestioncount != '') ? parseInt(currentQuestioncount)+1 : 1;
            
              $('#gitAskQuestion').html(updatedcount);
              $('#gitAskQuestionCountDiv').show();       
            }
            else {
              $('#questionMessage{{.questionCode}}').html("");
              $('#questionMessage{{.questionCode}}').removeClass('alert-success');
              $('#questionMessage{{.questionCode}}').addClass('alert-danger');
              $('#questionMessage{{.questionCode}}').html("Question failed to submit.");
              $('#questionMessage{{.questionCode}}').show();            
              $('#questionMessage{{.questionCode}}').prop("disabled", false);
            }
              $('#questionMessage{{.questionCode}}').fadeOut(8000);
            })
              .catch(error => {
                  console.log(error);
              });

        }
        else{
            if (getCookie('personid') == null)
            $('#loginModalCenter').modal('toggle');
            else
            $('#reLoginModalCenter').modal('toggle');
          }
        }
      }
    });

    /// Questions Get data starts here ////
      var offeringName = "{{ $productName}}";
      var replacedString = $("#offeringQuestion{{.questionCode}}").text().replace("offeringName", offeringName);
      $("#offeringQuestion{{.questionCode}}").text(replacedString);

      $('#questionTitle{{.questionCode}}').keyup(function(){
        ($('#questionTitle{{.questionCode}}').val()!= '') ? $('#questionButton{{.questionCode}}').show() : $('#questionButton{{.questionCode}}').hide();        
      });

      var productId = "{{ $productId }}";
      var metricName = "medigy_qual_exp_{{ .localQuestionCode }}";
      //console.log("query{\n  getPromData(metricName:\""+metricName+"\",metricQuery:\"{offeringId=\\\""+productId+"\\\"}[2y]\"){\n    prometheusData\n    status\n  }\n}");
      var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "GET", "query": "query{\n  getPromData(metricName:\""+metricName+"\",metricQuery:\"{offeringId=\\\""+productId+"\\\"}[2y]\"){\n    prometheusData\n    status\n  }\n}" };
      ajaxPageServiceCall.serviceCall(serviceData).then(questionResponse => {
        if(questionResponse.data.getPromData.status == "success"){
          var JSONData = JSON.parse(questionResponse.data.getPromData.prometheusData);
          var questionCollection = [];
          for(var i = 0; i < JSONData.length; i++) {
            var obj = JSONData[i];   
            questionCollection.push({id:obj.offeringId,ques:obj.questionTitle});
          }
          if(JSONData.length > 0){                    
            var questionlist="";
            for(j = 0; j < (questionCollection.length); j++){
              questionlist += '<div class="new-ofering-row-5-cell-1-list col-md-12 mb-1 mt-2">';    
              questionlist += '<div class="">'+ '<i class="fas fa-caret-right"></i> ' +questionCollection[j]["ques"]+'</div> '; 
              questionlist += '<div class="clearfix"></div>';
              questionlist += '</div>';
            }
            $('#questionCollectionDiv{{.questionCode}}').html(questionlist);   
            $('#gitAskQuestion').html(JSONData.length);
            $('#gitAskQuestionCountDiv').show();
          }
        }

      })
      .catch(error => {
          console.log(error);
      });      

    /// Questions Get data ends here ////
  </script>
{{ end }}
{{ if eq $itemClassValue "online-offline-source" }} 
  {{ $.Scratch.Set "outerQuestionCode"  .questionCode }}
  {{ $outerQuestionCode:= $.Scratch.Get "outerQuestionCode" }}
  <div class="accordion" id="accordion{{$i}}">
    <div class="card">
      <div class="card-header" id="heading{{$i}}">
        <h2 class="mb-0">
        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapse{{$i}}" aria-expanded="false" aria-controls="collapseOne">
          <i class="{{ range $key, $value := .prefix }} {{ if eq $key "iconClass" }} {{ print  $value }} {{ end }} {{ end }}"></i> <span id="offeringQuestion{{.questionCode}}">{{.question}}</span> <i class="fa fa-chevron-up right-icon"></i>
        </button>
        </h2>
      </div>
      <div id="collapse{{$i}}" class="collapse" aria-labelledby="heading{{$i}}" data-parent="#accordion{{$i}}" style="">
        <div class="card-body">
          <div class="new-ofering-row-5-cell-1 row ml-0">
            <div class="new-ofering-row-5 w-100">                                     
              <div id="sourceMessage" class="alert alert-success" style="display: none;"></div>
              <div class="form-group row"></div>  
                {{range .items}}
                  {{ if eq .dataType "CNE"}}                      
                    <div class="form-group row" id="{{.questionCode}}" >
                      <div class="col-md-3">{{ .question}}</div>
                      <div class="col-md-4">
                        <select name="{{.questionCode}}Source" id="{{.questionCode}}Source" class="form-control" >
                          {{ range .answers }}
                            <option value="{{ .text }}">{{.text}}</option>  
                          {{ end }}                
                        </select> 
                      </div>
                      <div class="col-md-4">
                        <input  name="add-{{.questionCode}}" id="add-{{.questionCode}}" class="form-control text-input-{{$outerQuestionCode}}"/>
                      </div>
                    </div>
                  {{ end}}
                  {{ if eq .dataType "ST"}}
                    <div class="form-group row" id="{{.questionCode}}" >
                      <div class="col-md-3"> {{ .question }}</div>
                      <div class="col-md-8">
                        <input  name="{{.questionCode}}Source" id="{{.questionCode}}Source" class="form-control text-input-{{$outerQuestionCode}}"/>
                      </div>
                    </div>
                  {{ end }}  
                {{ end }}
              <div class="">
                <input type="submit" value="Submit" id="sourceButton{{$outerQuestionCode}}" class="btn btn-primary q-btn-1 cad-source-btn" productname="{{$productName}}" productid="{{ $productId }}" style="display:none"> 
              </div> 
            </div>
            <div id="sourceCollectionDiv" class="pt-4 split-row"></div> 			
          </div> 
        </div>
      </div>
    </div>
  </div>
  <script>
    /// Fetching source details on page load starts
      {{ $.Scratch.Add  "loopItemCount"  0 }}
      {{range .items}}
        {{ if eq .dataType "ST"}}
          var tempOtherSource= "{{ .questionCode}}AddInfo";
          var sourcelist="";
          var productId = "{{ $productId }}";

          var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "GET", "query": "query{\n  getPromData(metricName:\"medigy_qual_exp_source_{{.localQuestionCode}}\",metricQuery:\"{offeringId=\\\""+productId+"\\\"}[2y]\"){\n    prometheusData\n    status\n  }\n}" };
          ajaxPageServiceCall.serviceCall(serviceData).then(sourceResponse => {
            if(sourceResponse.data.getPromData.status == "success"){    
              var JSONData = JSON.parse(sourceResponse.data.getPromData.prometheusData);
              var userArray = JSONData.filter(function (el) {
                  return el.userId == getCookie('personid')
              });
              var tmpsourceCollection2 = [];
              tmpsourceCollection2 = JSONData;       
              for(j =0; j<(JSONData.length);j++){
                var count = 0;
                for(i =0; i< (tmpsourceCollection2.length);i++){
                  if(JSONData[j][tempOtherSource] == JSONData[i][tempOtherSource])
                    count++;
                }  
                JSONData[j]['count'] = count;           
              }
              if(JSONData.length > 0){                    
                var obj = {};
                for ( var i = 0, len = JSONData.length; i < len; i++ ){
                  if(JSONData[i][tempOtherSource]){
                    if(!obj[JSONData[i][tempOtherSource]]) 
                        obj[JSONData[i][tempOtherSource]] = JSONData[i];
                  }                
                }
                var newArr = [];
                for ( var key in obj ) newArr.push(obj[key]);         
                for(j = 0; j < (newArr.length); j++){
                  var styleconst = "";
                  for(var i=0; i<userArray.length; i++){		
                    if (userArray[i][tempOtherSource] == newArr[j][tempOtherSource])	                           
                      var styleconst = 'style="pointer-events: none;"';      				
                  }
                  sourcelist += '<div class="new-ofering-row-5-cell-1-list">';
                  sourcelist += '<a id="sourceVote" class="sourceVote" class="sourceVote"' + styleconst +' data-title="'+newArr[j][tempOtherSource]+'" data-metric="{{.localQuestionCode}}" data-leadtype="{{.questionCode}}" href="JavaScript:Void(0);"><div class="new-ofering-row-5-cell-1-list-left"><span class="arrow"><i class="fas fa-sort-up"></i></span> <span class="number">'+newArr[j]["count"]+'</span></div></a>';  
                  sourcelist += '<div class="new-ofering-row-5-cell-1-list-right">'+newArr[j][tempOtherSource]+'</div> '; 
                  sourcelist += '<div class="clearfix"></div>';
                  sourcelist += '</div>';
                }
                $('#sourceCollectionDiv').html(sourcelist);                   
              }
            }
          })
          .catch(error => {
              console.log(error);
          }); 

        {{ end }}
        {{ if eq .dataType "CNE"}}
          {{ $.Scratch.Add "loopItemCount" 1 }}
          {{ $loopItemCount:=  $.Scratch.Get "loopItemCount" }}
          {{ $itemAdditionalInfo:=  print "itemAdditionalInfo" $loopItemCount }}
          {{ $itemSource:=  print "itemSource" $loopItemCount }}
          var {{ safeJS  ($itemAdditionalInfo)  }} = "{{.questionCode}}AddInfo";
          var {{ safeJS  ($itemSource)  }} = "{{.questionCode}}Source";
          var productId = "{{ $productId }}";
          var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "GET", "query": "query{\n  getPromData(metricName:\"medigy_qual_exp_source_{{.localQuestionCode}}\",metricQuery:\"{offeringId=\\\""+productId+"\\\"}[2y]\"){\n    prometheusData\n    status\n  }\n}" };
          ajaxPageServiceCall.serviceCall(serviceData).then(sourceResponse => {
            if(sourceResponse.data.getPromData.status == "success"){
              var JSONData = JSON.parse(sourceResponse.data.getPromData.prometheusData);
              var userArray = JSONData.filter(function (el) {
                  return el.userId == getCookie('personid')
              });
              var tmpsourceCollection2 = [];
              tmpsourceCollection2 = JSONData;       
              for(j =0; j<(JSONData.length);j++){
                var count = 0;
                for(i =0; i< (tmpsourceCollection2.length);i++){
                  if(JSONData[j][{{ safeJS  ($itemAdditionalInfo)  }} ] == JSONData[i][{{ safeJS  ($itemAdditionalInfo)  }} ])
                    count++;
                }  
                JSONData[j]['count'] = count;           
              }   
              if(JSONData.length > 0){
                var obj = {};
                for ( var i = 0, len = JSONData.length; i < len; i++ ){
                  if(JSONData[i][{{ safeJS  ($itemAdditionalInfo)  }}]){
                    if(!obj[JSONData[i][{{ safeJS  ($itemAdditionalInfo)  }} ]]) 
                      obj[JSONData[i][{{ safeJS  ($itemAdditionalInfo)  }} ]] = JSONData[i];
                  }
                }
                var newArr = [];
                for ( var key in obj ) newArr.push(obj[key]);
                for(j = 0; j < (newArr.length); j++){
                  var styleconst = "";
                  for(var i=0; i<userArray.length; i++){		
                    if (userArray[i][{{ safeJS  ($itemAdditionalInfo)  }}] == newArr[j][{{ safeJS  ($itemAdditionalInfo)  }} ])	                           
                      var styleconst = 'style="pointer-events: none;"';      				
                  }
                  sourcelist += '<div class="new-ofering-row-5-cell-1-list">';
                  sourcelist += '<a id="sourceVote" class="sourceVote"' + styleconst +' data-title="'+newArr[j][{{ safeJS  ($itemAdditionalInfo)  }} ]+'" data-metric="{{.localQuestionCode}}" data-source="'+newArr[j][{{ safeJS  ($itemSource)  }} ]+'" data-leadtype="{{.questionCode}}" href="JavaScript:Void(0);"><div class="new-ofering-row-5-cell-1-list-left"><span class="arrow"><i class="fas fa-sort-up"></i></span> <span class="number">'+newArr[j]["count"]+'</span></div></a>';  
                  sourcelist += '<div class="new-ofering-row-5-cell-1-list-right">'+newArr[j][{{ safeJS  ($itemAdditionalInfo)  }} ]+'</div> '; 
                  sourcelist += '<div class="clearfix"></div>';
                  sourcelist += '</div>';
                }
                $('#sourceCollectionDiv').html(sourcelist);                   
              }
            }
          })
          .catch(error => {
              console.log(error);
          });
 
        {{ end }}
      {{ end }}
    /// Fetching source details on page load ends

    /// source data upvoting starts
      $('body').on('click', '#sourceVote', function (e) {
        e.preventDefault();
        if ($(this).hasClass("checked")) { 
          console.log('exists'); return false;
        }
        var title = $(this).attr("data-title"); 
        var sourcetype = $(this).attr("data-source");
        var productId = "{{ $productId }}";
        var source = "Attest-"+productId;
        var personId = getCookie('personid');
        var leadtypeAddInfo = $(this).attr("data-leadtype")+"AddInfo"; 
        var leadtypeSource = $(this).attr("data-leadtype")+"Source"; 
        var metricName = "medigy_qual_exp_source_"+$(this).attr("data-metric"); 
        var currentUpvote = $(this).find(".number").html();
        var this_var = $(this);
        var timestamp = Date.now();    
        if (getCookie('personid') != null  && getCookie('sessionId')!= null && getCookie('sessionId')!= '' ) { 
          $(this).addClass("checked");         
          if(title !=""){  
            var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "POST", "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"offeringId\", \n        value: \""+productId+"\"\n     },   \n      {\n        key: \""+leadtypeAddInfo+"\", \n        value: \""+title+"\"\n      },   \n      {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"createdat\", \n        value: \""+timestamp+"\"\n      },   \n      {\n        key: \""+leadtypeSource+"\", \n        value: \""+sourcetype+"\"\n      }, \n     {\n        key: \"userId\", \n        value: \""+personId+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+metricName+"\", \n    metricName: \""+metricName+"\") {\n    status\n    message\n    errorCode\n  }\n}" };
            ajaxPageServiceCall.serviceCall(serviceData).then(response => {
              if(response.data.addPrometheusData.status == "SUCCESS"){           
                currentUpvote++;                                
              }
              this_var.find(".number").html(currentUpvote);              
            })
          .catch(error => {
              console.log(error);
          });
             
          } 
        }  
        else{
          if (getCookie('personid') == null)
            $('#loginModalCenter').modal('toggle');
          else
            $('#reLoginModalCenter').modal('toggle');
        }
      });
    /// source data upvoting ends

    /// source form submission  starts here ///
      $('#sourceButton{{$outerQuestionCode}}').on("click", function (e) {
        e.preventDefault();   
        if (getCookie('personid') == null  || getCookie('sessionId')== null || getCookie('sessionId')== '' ) { 
            if (getCookie('personid') == null)
            $('#loginModalCenter').modal('toggle');
            else
            $('#reLoginModalCenter').modal('toggle');
        }
        else {
          {{ $.Scratch.Add  "itemCount"  0 }}  
          {{range .items}}
            {{ if eq .dataType "ST"}}
              var otherSourceInfo = $('#{{.questionCode}}Source').val();               
              var metricName = "medigy_qual_exp_source_{{ .localQuestionCode }}";               
              var productName = $(this).attr('productname');
              $('#sourceButton{{$outerQuestionCode}}').prop("disabled", true);
              var productId = $(this).attr('productid');
              var source = "Attest-"+productId;
              var personId = getCookie('personid'); 
              var sourceCollection = '';
              var timestamp = Date.now();
              // push other source details
              if(otherSourceInfo !=""){    
                
                var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "POST", "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"offeringId\", \n        value: \""+productId+"\"\n     },   \n      {\n        key: \"{{ .questionCode}}AddInfo\", \n        value: \""+otherSourceInfo+"\"\n      },   \n      {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"createdat\", \n        value: \""+timestamp+"\"\n      }, \n     {\n        key: \"userId\", \n        value: \""+personId+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+metricName+"\", \n    metricName: \""+metricName+"\") {\n    status\n    message\n    errorCode\n  }\n}" };
                ajaxPageServiceCall.serviceCall(serviceData).then(response => {
                
                  if(response.data.addPrometheusData.status == "SUCCESS"){           
                    $('#sourceMessage').html("");
                    var sourceCollection1 = '';
                    $('#sourceMessage').removeClass('alert-danger');
                    $('#sourceMessage').addClass('alert-success');
                    sourceCollection1 += '<div class="new-ofering-row-5-cell-1-list">';
                    sourceCollection1 += '<a class="sourceVote" href="#"><div class="new-ofering-row-5-cell-1-list-left"><span class="arrow"><i class="fas fa-sort-up"></i></span> <span class="number">'+'1'+'</span></div></a>';
                    sourceCollection1 += '<div class="new-ofering-row-5-cell-1-list-right">' +otherSourceInfo+'</div> ';                 
                    sourceCollection1 += '<div class="clearfix"></div>';
                    sourceCollection1 += '</div>';    
                    $("#sourceCollectionDiv").append(sourceCollection1);
                    $('#sourceMessage').append("Successfully submitted the details.");
                    $('#{{.questionCode}}Source').val('');
                    $('#add-{{.questionCode}}').val('');
                    $('#add-{{.questionCode}}').val('');
                    $('#sourceMessage').show();
                    $('#sourceButton{{$outerQuestionCode}}').prop("disabled", false);                 
                  }  
                  $('#sourceMessage').fadeOut(8000);
                })
                .catch(error => {
                    console.log(error);
                });

              }   
            {{ end }}
            {{ if eq .dataType "CNE"}}
              {{ $.Scratch.Add "itemCount" 1 }}
              {{ $itemCount:=  $.Scratch.Get "itemCount" }}
              {{ $itemAdditionalInfo:=  print "itemAdditionalInfo" $itemCount }}
              {{ $itemSource:=  print "itemSource" $itemCount }}
              {{ $metricName:=  print "metricName" $itemCount }}
              {{ $sourceCollection:=  print "sourceCollection" $itemCount }}             
              var {{ safeJS  ($itemAdditionalInfo)  }} = $('#add-{{.questionCode}}').val();
              var {{ safeJS  ($itemSource)  }} = $('#{{.questionCode}}Source').val();
              var {{ safeJS  ($metricName)  }} = "medigy_qual_exp_source_{{ .localQuestionCode }}";
              var productName = $(this).attr('productname');
              $('#sourceButton{{$outerQuestionCode}}').prop("disabled", true);
              var productId = $(this).attr('productid');
              var source = "Attest-"+productId;
              var personId = getCookie('personid'); 
              var {{ safeJS  ($sourceCollection)  }} = '';
              var timestamp = Date.now();
              // push Online/Offline source details
              if({{ safeJS  ($itemAdditionalInfo)  }} !=""){    
                
                var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "POST", "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"offeringId\", \n        value: \""+productId+"\"\n     },   \n      {\n        key: \"{{.questionCode}}AddInfo\", \n        value: \""+{{ safeJS  ($itemAdditionalInfo)  }}+"\"\n      },   \n      {\n        key: \"source\", \n        value: \""+source+"\"\n      },   \n      {\n        key: \"{{.questionCode}}Source\", \n        value: \""+{{ safeJS  ($itemSource)  }}+"\"\n      }, \n      {\n        key: \"createdat\", \n        value: \""+timestamp+"\"\n      }, \n     {\n        key: \"userId\", \n        value: \""+personId+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+{{ safeJS  ($metricName)  }}+"\", \n    metricName: \""+{{ safeJS  ($metricName)  }}+"\") {\n    status\n    message\n    errorCode\n  }\n}" };
                ajaxPageServiceCall.serviceCall(serviceData).then(response => {
                
                  if(response.data.addPrometheusData.status == "SUCCESS"){           
                    $('#sourceMessage').html("");
                    var {{ safeJS  ($sourceCollection)  }} = '';
                    $('#sourceMessage').removeClass('alert-danger');
                    $('#sourceMessage').addClass('alert-success');
                    {{ safeJS  ($sourceCollection)  }} += '<div class="new-ofering-row-5-cell-1-list">';
                    {{ safeJS  ($sourceCollection)  }} += '<a class="sourceVote" href="#"><div class="new-ofering-row-5-cell-1-list-left"><span class="arrow"><i class="fas fa-sort-up"></i></span> <span class="number">'+'1'+'</span></div></a>';
                    {{ safeJS  ($sourceCollection)  }} += '<div class="new-ofering-row-5-cell-1-list-right">' +{{ safeJS  ($itemAdditionalInfo)  }}+'</div> ';                 
                    {{ safeJS  ($sourceCollection)  }} += '<div class="clearfix"></div>';
                    {{ safeJS  ($sourceCollection)  }} += '</div>';  
                    $("#sourceCollectionDiv").append({{ safeJS  ($sourceCollection)  }});
                    $('#sourceMessage').append("Successfully submitted the details.");
                    $('#{{.questionCode}}Source').val('');
                    $('#add-{{.questionCode}}').val('');
                    $('#sourceMessage').show();
                    $('#sourceButton{{$outerQuestionCode}}').prop("disabled", false);                 
                  }
                    $('#sourceMessage').fadeOut(8000);
                })
                .catch(error => {
                    console.log(error);
                });                

              } 
            {{ end }}
          {{ end }}
        }
      }); 
    /// source form submission ends here ///

    $('.text-input-{{$outerQuestionCode}}').keyup(function(){
      $('#sourceButton{{$outerQuestionCode}}').show();
    });

    var offeringName = "{{ $productName}}";
    var replacedString = $("#offeringQuestion{{.questionCode}}").text().replace("offeringName", offeringName);
    $("#offeringQuestion{{.questionCode}}").text(replacedString);
  </script>
{{ end}}
{{ if eq $itemClassValue "radio-button-choice-type" }}
  {{ if (eq (.answers | len) 2) }}
    <div class="accordion" id="accordion{{ $i }}">
      <div class="card">
        <div class="card-header" id="heading{{ $i }}">
          <h2 class="mb-0">
          <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapse{{ $i }}" aria-expanded="false" aria-controls="collapseOne">
            <i class="{{ range $key, $value := .prefix }} {{ if eq $key "iconClass" }} {{ print  $value }} {{ end }} {{ end }}"></i> <span id="offeringQuestion{{.questionCode}}" >{{.question}}</span>
            <i class="fa fa-chevron-up right-icon"></i>
          </button>
          </h2>
        </div>
        <div id="collapse{{ $i }}" class="collapse" aria-labelledby="heading{{ $i }}" data-parent="#accordion{{ $i }}" style="">
          <div class="card-body">
            <div class="new-ofering-row-5">   
              <div class="switch-field" data-app="{{$productId}}" data-tenantId='{{$tenantId}}'>
                {{ range .answers | first 1 }}
                {{ $.Scratch.Set "radioFirstOption"  .code }}
                {{ end }}
                {{ range .answers | last 1 }}
                {{ $.Scratch.Set "radioSecondOption"  .code }}
                {{ end }}
                {{ $radioFirstOption:= $.Scratch.Get "radioFirstOption" }}
                {{ $radioSecondOption:= $.Scratch.Get "radioSecondOption" }}
                {{ $metricName:= .localQuestionCode }}
                {{ range .answers }}
                  <input type="radio" id="radio-{{.code}}" name="switch-one" data-metric="{{ $metricName }}" data-name="{{ $productName }}" data-id="{{ $productId }}" value="{{.code}}"  />
                  <label for="radio-{{.code}}" id="radio-{{.code}}-label">{{.text}}</label>
                {{ end }}                    
              </div>     
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>     
      var offeringName = "{{ $productName}}";
      var replacedString = $("#offeringQuestion{{.questionCode}}").text().replace("offeringName", offeringName);
      $("#offeringQuestion{{.questionCode}}").text(replacedString);
      // verify and enable bluebutton status changing
      var personId = getCookie('personid');
      if (personId == null || $('.switch-field').attr('data-tenantId') != getCookie('tenantId'))
        $("#radio-{{$radioFirstOption}}-label, #radio-{{$radioSecondOption}}-label").addClass("point-event-none");
    
      $('.switch-field input[type=radio]').click(function(e){    
        var timestamp = Date.now();     
        var bluebuttonStatus =  $(this).val();
        var personId = getCookie('personid');
        if (personId != null && $('.switch-field').attr('data-tenantId') == getCookie('tenantId') && getCookie('sessionId')!= null && getCookie('sessionId')!= '' ){
          $(this).css('cursor', 'default');
          var productId = $(this).attr('data-id');
          var metricName = "medigy_qual_exp_"+$(this).attr('data-metric');
          var source = "Attest-"+productId;
          var productName = $(this).attr('data-name');
          var session = getCookie('sessionId');

          var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "POST", "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"offeringId\", \n        value: \""+productId+"\"\n      }, \n     {\n        key: \"bluebutton\", \n        value: \""+bluebuttonStatus+"\"\n      }, \n     {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"offeringName\", \n        value: \""+productName+"\"\n      }, \n      {\n        key: \"createdat\", \n        value: \""+timestamp+"\"\n      }, \n      {\n        key: \"userId\", \n        value: \""+personId+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+metricName+"\", \n    metricName: \""+metricName+"\") {\n    status\n    message\n    errorCode\n  }\n}" };
                ajaxPageServiceCall.serviceCall(serviceData).then(response => {
                console.log(response);

                })
                .catch(error => {
                    console.log(error);
                });          

        }
        else{
          if (getCookie('personid') == null)
            $('#loginModalCenter').modal('toggle');
          else
            $('#reLoginModalCenter').modal('toggle');
        return false;
        }
      });
      /// blue button Get data starts here ////
        var metricName = "medigy_qual_exp_{{.localQuestionCode}}";
        var productId = "{{ $productId}}";

        var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "GET", "query": "query{\n  getPromData(metricName:\""+metricName+"\",metricQuery:\"{offeringId=\\\""+productId+"\\\"}[2y]\"){\n    prometheusData\n    status\n  }\n}" };
                ajaxPageServiceCall.serviceCall(serviceData).then(response => {
                
                  if(response.data.getPromData.status == "success"){
                    var JSONData = JSON.parse(response.data.getPromData.prometheusData);
                    if(JSONData.length > 0)   
                      var bluebuttonstatus = JSONData[0].bluebutton;                
                  }        
                  if(bluebuttonstatus == "{{ $radioFirstOption }}")
                    $('#radio-{{ $radioFirstOption }}').prop('checked', true);        
                  else if(bluebuttonstatus == "{{ $radioSecondOption }}")
                    $('#radio-{{ $radioSecondOption }}').prop('checked', true);
                  else
                    $('#radio-{{ $radioSecondOption }}').prop('checked', true);  
                })
                .catch(error => {
                    console.log(error);
                });        
 
      /// blue button Get data ends here ////
    </script>
  {{ end }}
  {{ if (gt (.answers | len) 2) }}
    <div class="accordion" id="accordion{{$i}}">
      <div class="card">
        <div class="card-header" id="heading{{$i}}">
          <h2 class="mb-0">
            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapse{{$i}}" aria-expanded="false" aria-controls="collapseOne">
              <i class="{{ range $key, $value := .prefix }} {{ if eq $key "iconClass" }} {{ print  $value }} {{ end }} {{ end }}"></i> <span id="offeringQuestion{{.questionCode}}" >{{.question}}</span>
              <i class="fa fa-chevron-up  right-icon"></i>
            </button>
          </h2>
        </div>
        <div id="collapse{{$i}}" class="collapse" aria-labelledby="heading{{$i}}" data-parent="#accordion{{$i}}" style="">
          <div class="card-body">
            <div class="new-ofering-row-5">   
              <div class="new-ofering-row-5">     
                  <div class="form-group row" id="outer_div_{{ .questionCode }}" >             
                    <div class="col-md-12" id="list_terms">
                      {{$questionCode := .questionCode}}
                      {{$localQuestionCode := .localQuestionCode}}
                      {{ range .answers }} 
                        <div class="new-ofering-row-5-cell-1-list">
                          <div id="{{ .code }}" class="new-ofering-row-5-cell-1-list-right pt-4">{{ .text }}</div>
                            <a class="upvote-{{ $questionCode }}" id="tag{{ .code }}" data-name="{{ .text }}"  data-metric="{{$localQuestionCode}}" data-id="{{ .code }}" href="JavaScript:Void(0);">
                              <div id="{{ .code }}" class="new-ofering-row-5-cell-1-list-left">
                                <span class="arrow"><i class="fas fa-sort-up"></i></span>
                                <span class="number" id="count{{ .code }}"></span>
                              </div>
                            </a>            
                          <div class="clearfix"></div>
                        </div>
                      {{end}}
                    </div>                  
                  </div> 
              </div>        
            </div> 
          </div>
        </div>
      </div>
    </div>
    <script>
      /// Get data starts here
        var offeringName = "{{ $productName}}";
        var replacedString = $("#offeringQuestion{{.questionCode}}").text().replace("offeringName", offeringName);
        $("#offeringQuestion{{.questionCode}}").text(replacedString);
        var metricName = "medigy_qual_exp_{{ $localQuestionCode}}";
        var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "GET", "query": "query{\n  getPromData(metricName:\""+metricName+"\",metricQuery:\"{offeringId=\\\"{{$productId}}\\\"}[2y]\"){\n    prometheusData\n    status\n  }\n}" };
        ajaxPageServiceCall.serviceCall(serviceData).then(response => {
        
          if(response.data.getPromData.status == "success"){
            var JSONData = JSON.parse(response.data.getPromData.prometheusData);
            var userArray = JSONData.filter(function (el) {
            return el.userId == getCookie('personid')
            });
            var tmpdevCollection = [];
            tmpdevCollection = JSONData; 
            for(j =0; j<(JSONData.length);j++){
              var count = 0;
              for(i =0; i< (tmpdevCollection.length);i++){
                if(JSONData[j]['itemId'] == JSONData[i]['itemId']) {
                  count++;
                }                                                   
              } 
              JSONData[j]['count'] = count; 
              $('#count'+JSONData[j]['itemId']).html(JSONData[j]['count']); 
              for(var i=0; i<userArray.length; i++){		
                if (userArray[i].itemId == JSONData[j]['itemId'])
                  $('#tag'+JSONData[j]['itemId']).css("pointer-events","none");   				                                                   
              }        
            }
          }
        })
        .catch(error => {
            console.log(error);
        });

      /// Get data ends here  
      /// Upvote push counts starts here 
        $('body').on('click', '.upvote-{{ $questionCode }}', function (e) {
          e.preventDefault();
          if ($(this).hasClass("checked")) { 
              console.log('exists'); return false;
          }
          var timestamp = Date.now();
          var itemName = $(this).attr("data-name"); 
          var itemId = $(this).attr("data-id"); 
          var personId = getCookie('personid');
          var currentUpvote = $(this).find(".number").html();
          var this_var = $(this);           
          if(personId != null){
            $(this).addClass("checked");
            if(itemName !=""){
              var metricName=  "medigy_qual_exp_"+$(this).attr('data-metric');
              var serviceData = { "url": "{{ $.Site.Params.GraphQLUrl }}", "method": "POST", "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"offeringId\", \n        value: \"{{$productId}}\"\n      }, \n     {\n        key: \"itemName\", \n        value: \""+itemName+"\"\n      }, \n      {\n        key: \"createdat\", \n        value: \""+timestamp+"\"\n      }, \n     {\n        key: \"itemId\", \n        value: \""+itemId+"\"\n      }, \n      {\n        key: \"userId\", \n        value: \""+personId+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+metricName+"\", \n    metricName: \""+metricName+"\") {\n    status\n    message\n    errorCode\n  }\n}" };
                ajaxPageServiceCall.serviceCall(serviceData).then(response => {
                  if(response.data.addPrometheusData.status == "SUCCESS")           
                    currentUpvote++; 
                  this_var.find(".number").html(currentUpvote);                  

                })
                .catch(error => {
                    console.log(error);
                });


            } 
          }  
          else{
          $('#loginModalCenter').modal('toggle');
          }
        });
      /// Upvote push counts ends here 
    </script>
  {{ end }}
{{ end }}
{{ end }}


