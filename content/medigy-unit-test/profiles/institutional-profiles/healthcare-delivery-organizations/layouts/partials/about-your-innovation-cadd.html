{{ $instId:= $.Scratch.Get "instId" }}
{{ $instName:= $.Scratch.Get "instName" }}
{{ $vendorId:= $.Scratch.Get "vendorid" }}
{{ $claimStatus:= $.Scratch.Get "claimStatus" }}
{{ $.Scratch.Add  "i"  0 }}
{{ range first 1 .Site.Data.about_your_innovation_lhc_form.items }}
{{ range .items }}
{{ $.Scratch.Add "i" 1 }}
{{ $i:= $.Scratch.Get "i" }}
  {{ if eq .dataType "CNE" }}
    {{ if (eq (.answers | len) 2) }}
      <article class="yes-no-row inn-click "> 
        <div class="row innovator-question question-{{ .questionCode}} ">
          <div class="col-md-6">
            <i class="{{ .prefix }} icon-position-1"></i>
            <h4 id="text-{{ .questionCode}}" class="pl-5 normal-heading">{{ .question}}</h4>
          </div>
          <div id="icon-answered-date-{{ .questionCode}}" class="col-md-4 ans-update-date icon-{{ .questionCode}}">
            <i class="far fa-clock icon-position-1"></i>
            <p id="question-updated-on-{{ .questionCode}}" class="pl-5"></p>
          </div>
          <div id="icon-answered-date-{{ .questionCode}}" class="col-md-2 ans-update-date icon-{{ .questionCode}} edit-{{ .questionCode}}" style="display:none;">
            <a class="update-btn-edit" id="edit-btn-{{ .questionCode}}" href="javascript:void(0)"><i class="far fa-edit icon-position-1"></i>
            <span id="question-updated-on-{{ .questionCode}}" class="pl-5">Edit</span></a>          
          </div>
          <div class="alert alert-secondary innovator-edit-box" id="edit-badge-{{ .questionCode}}" style="display:none">
            <div class="row">
              <div class="col-md-6">{{ .question}}</div>                 
              {{ $questionCode := .questionCode}}
              {{ $localQuestionCode := .localQuestionCode}}
              {{ range .answers | first 1 }}
              {{ $.Scratch.Set "labelFirstChoice"  .label }}
              {{ $.Scratch.Set "textFirstChoice"  .text }}
              {{ end }}
              {{ range .answers | last 1 }}
              {{ $.Scratch.Set "labelSecondChoice"  .label }}
              {{ $.Scratch.Set "textSecondChoice"  .text }}
              {{ end }}
              {{ $labelFirstChoice:= $.Scratch.Get "labelFirstChoice" }}
              {{ $labelSecondChoice:= $.Scratch.Get "labelSecondChoice" }}
              {{ $textFirstChoice:= $.Scratch.Get "textFirstChoice" }}
              {{ $textSecondChoice:= $.Scratch.Get "textSecondChoice" }}
              {{ $id_first:= lower $labelFirstChoice }}
              {{ $id_second:= lower $labelSecondChoice }}                  
              <div class="col-md-6">
                <button class="new-ofer-btn-1 {{ $id_first }} btn white fix-width-yes-btn" id="edit-{{$id_first}}-{{ $questionCode}}" type="button"  data-action="update" data-metric="{{ $localQuestionCode}}" data-title="{{ $instName }}" data-id="{{ $instId }}" data-label="{{$labelFirstChoice}}" data-text="{{$textFirstChoice}}"><i class="fas fa-thumbs-up"></i> {{ $labelFirstChoice}} </button>             
                <button class="new-ofer-btn-1 {{ $id_second }} btn white fix-width-yes-btn" id="edit-{{$id_second}}-{{ .questionCode}}" type="button" data-action="update" data-metric="{{ .localQuestionCode}}" data-title="{{ $instName }}" data-id="{{ $instId }}" data-label="{{$labelSecondChoice}}" data-text="{{$textSecondChoice}}" ><i class="fas fa-thumbs-down"></i> {{ $labelSecondChoice}} </button>                      
                <button type="button" class="close" id="close-btn-{{ .questionCode}}" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
              </div> 
            </div> 
          </div>
          <div id="btn-{{ .questionCode}}" class="col-md-2 yes-no-btns">                                         
            <button class="new-ofer-btn-1 {{ $id_first }} btn white fix-width-yes-btn" id="{{$id_first}}-{{ $questionCode}}" type="button"  data-metric="{{ $localQuestionCode}}" data-title="{{ $instName }}" data-id="{{ $instId }}" data-label="{{$labelFirstChoice}}" data-text="{{$textFirstChoice}}"><i class="fas fa-thumbs-up"></i> {{ $labelFirstChoice}} </button>             
            <button class="new-ofer-btn-1 {{ $id_second }} btn white fix-width-yes-btn" id="{{$id_second}}-{{ .questionCode}}" type="button" data-metric="{{ .localQuestionCode}}" data-title="{{ $instName }}" data-id="{{ $instId }}" data-label="{{$labelSecondChoice}}" data-text="{{$textSecondChoice}}" ><i class="fas fa-thumbs-down"></i> {{ $labelSecondChoice}} </button>         
          </div>
        </div>
        <div class="row innovator-answer answer-{{ .questionCode}} " style="display: none;">
          <div class="col-md-6">
            <div class="icon-space-left-1">
            <i class="{{ .prefix }} icon-position-1"></i>
            <h4 id="text-answer-{{ .questionCode}}" class="normal-heading"></h4>
            </div>
          </div>
          <div class="col-md-4 ans-update-date icon-{{ .questionCode}}" >
            <i class="far fa-clock icon-position-1"></i>
            <p id="answer-updated-on-{{ .questionCode}}" class="pl-5"></p>
          </div>          
          <div id="btn-answer-{{ .questionCode}}" class="col-md-2 text-right">
            <button class="new-ofer-btn-1 yes btn white agree-btn" title="I Endorse that" id="agree-{{ .questionCode}}" type="button" data-title="{{ $instName }}" data-id="{{ $instId}}" data-metric="{{ .localQuestionCode}}">Endorse (<span class="" id="{{ .questionCode }}-agree-count">0</span>)</button>
          </div>
        </div>
      </article>
      <script>
        /// Get data on page load starts here ////
          {{ $codeFirstChoice := print  "codeFirstChoice_" $i }}
          {{ $codeSecondChoice := print  "codeSecondChoice_" $i }}
          {{ $text_FirstChoice := print  "textFirstChoice_" $i }}
          {{ $text_SecondChoice := print  "textSecondChoice_" $i }}         
          var {{ safeJS  ($codeFirstChoice) }}="{{ $labelFirstChoice}}";
          var {{ safeJS  ($codeSecondChoice) }}="{{ $labelSecondChoice}}";
          var {{ safeJS ($text_FirstChoice) }}="{{ $textFirstChoice}}";
          var {{ safeJS ($text_SecondChoice) }}="{{ $textSecondChoice}}";    
          var metricName =  "medigy_qual_exp_institution_inno_{{ .localQuestionCode}}"; 
          var institutionId = "{{ $instId }}";
          var settings = {
            "async": true,
            "crossDomain": true,
            "url": "{{ $.Site.Params.GraphQLUrl }}",
            "method": "POST",
            "headers": {
              "Content-Type": "application/x-www-form-urlencoded",
              "Accept": "*/*",
              "Cache-Control": "no-cache",
              "Connection": "keep-alive"
            },
            "data": {
              "query": "query{\n  getPromData(metricName:\""+ metricName +"\",metricQuery:\"{institutionId=\\\""+institutionId+"\\\"}[1y]\",groupByParam:[\"userId\",\"institutionId\"]){\n    prometheusData\n    status\n  }\n}"
            }
          } 
          $.ajax(settings).done(function (response) {
            if(response.data.getPromData.status == "success"){
              var JSONData = JSON.parse(response.data.getPromData.prometheusData);
              if(JSONData.length > 0){
              for(i =0; i< (JSONData.length);i++){
                timestamp = JSONData[i]['time'];
                updatedDate = new Date(timestamp * 1000);
                var months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
                var currentMonth= months[updatedDate.getMonth()];
                var date = updatedDate.getDate();
                var year = updatedDate.getFullYear(); 
                var answeredDate = currentMonth+" "+date+", "+year;               
                if(JSONData[i]['selectedVal'] == {{ safeJS  ($codeFirstChoice) }})
                {
                  $("#text-{{ .questionCode}}").text({{ safeJS ($text_FirstChoice) }});
                  $("#text-answer-{{ .questionCode}}").text({{ safeJS ($text_FirstChoice) }});
                  var labelStatus = "Answered on ";
                  if(JSONData[i]['addUpdateStatus'])
                    (JSONData[i]['addUpdateStatus']=="update") ? labelStatus= "Updated on " : labelStatus = "Answered on "; 
                  $("#answer-updated-on-{{ .questionCode}}").text(labelStatus+answeredDate+ " by Senior Executive at "+ {{ $instName}});
                  $("#question-updated-on-{{ .questionCode}}").text(labelStatus+answeredDate+ " by Senior Executive at "+ {{ $instName}});
                  $("#edit-{{$id_first}}-{{ $questionCode}}").attr("disabled", true);                       
                  var tooltipText= {{ safeJS ($text_FirstChoice) }};
                  var tooltipAnswer=tooltipText.replace("We","");              
                  $("#agree-{{ .questionCode}}").attr("title","I Endorse that {{ $instName }}"+tooltipAnswer);                      
                }
                else if(JSONData[i]['selectedVal'] == {{ safeJS  ($codeSecondChoice) }})
                {
                  $("#text-{{ .questionCode}}").text({{ safeJS ($text_SecondChoice) }});                   
                  $("#text-answer-{{ .questionCode}}").text({{ safeJS ($text_SecondChoice) }});
                  var labelStatus = "Answered on ";
                  if(JSONData[i]['addUpdateStatus'])
                    (JSONData[i]['addUpdateStatus']=="update") ? labelStatus= "Updated on " : labelStatus = "Answered on ";
                  $("#answer-updated-on-{{ .questionCode}}").text(labelStatus +answeredDate+ " by Senior Executive at "+ {{ $instName}});
                  $("#question-updated-on-{{ .questionCode}}").text(labelStatus +answeredDate+ " by Senior Executive at "+ {{ $instName}});
                  $("#edit-{{$id_second}}-{{ $questionCode}}").attr("disabled", true);
                  var tooltipText={{ safeJS ($text_SecondChoice) }};
                  var tooltipAnswer=tooltipText.replace("We","");              
                  $("#agree-{{ .questionCode}}").attr("title","I Endorse that {{ $instName }}"+tooltipAnswer);                     
                }              
              }       
              $('#answerStatus').val(1);
              if(getCookie('personid') != null && $('#answerStatus').val() ==1 && {{ $claimStatus}} == true && getCookie('personid') != "{{ $vendorId}}")
                $(".answer-{{ .questionCode}}").show();        
              else 
                $("#btn-{{ .questionCode}}").hide();
            }
            else
              $('#answerStatus').val(0);
            var answerStatus = $('#answerStatus').val();
            var session = {"personId":getCookie('personid'),"sessionId":getCookie('sessionId'),"sessionUser":getCookie('firstname')};
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPublicAnsweredAboutYourInnovation(medigyAuthServicePolicies, answerStatus, session, visible=[".publicAboutYourInnovation-answered"], hidden=[".publicAboutYourInnovation-notAnswer",".publicAboutYourInnovation",".privateAboutYourInnovation-innovator-notAnswered",".privateAboutYourInnovation-claimed-notAnswered",".privateAboutYourInnovation-answered-claimed",".privateAboutYourInnovation-notAnswered-notClaimed",".privateAboutYourInnovation-innovator-answered"]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPrivateNotansweredClaimedInnovatorAboutYourInnovation(medigyAuthServicePolicies, answerStatus, "{{ $vendorId}}", session, visible=[".privateAboutYourInnovation-innovator-notAnswered"], hidden=[".publicAboutYourInnovation-notAnswer",".publicAboutYourInnovation",".publicAboutYourInnovation-answered",".privateAboutYourInnovation-claimed-notAnswered",".privateAboutYourInnovation-answered-claimed",".privateAboutYourInnovation-notAnswered-notClaimed",".privateAboutYourInnovation-innovator-answered"]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPrivateAnsweredInnovatorAboutYourInnovation(medigyAuthServicePolicies, answerStatus, "{{ $vendorId}}","{{ .questionCode}}", session, visible=[".privateAboutYourInnovation-innovator-answered"], hidden=[".publicAboutYourInnovation-notAnswer",".publicAboutYourInnovation",".publicAboutYourInnovation-answered",".privateAboutYourInnovation-innovator-notAnswered",".privateAboutYourInnovation-claimed-notAnswered",".privateAboutYourInnovation-answered-claimed",".privateAboutYourInnovation-notAnswered-notClaimed"]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPrivateNotansweredClaimedNotinnovatorAboutYourInnovation(medigyAuthServicePolicies, answerStatus,"{{ $claimStatus}}", "{{ $vendorId}}", session, visible=[".privateAboutYourInnovation-claimed-notAnswered"], hidden=[".publicAboutYourInnovation-notAnswer",".publicAboutYourInnovation",".publicAboutYourInnovation-answered",".privateAboutYourInnovation-innovator-answered", ".privateAboutYourInnovation-innovator-notAnswered",".privateAboutYourInnovation-answered-claimed",".privateAboutYourInnovation-notAnswered-notClaimed"], disableData=[], addClassData=[]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPrivateAnsweredNotinnovatorAboutYourInnovation(medigyAuthServicePolicies, answerStatus, "{{ $vendorId}}", "{{ .questionCode}}",session, visible=[".privateAboutYourInnovation-answered-claimed"], hidden=[".publicAboutYourInnovation-notAnswer", ".publicAboutYourInnovation",".publicAboutYourInnovation-answered",".privateAboutYourInnovation-innovator-answered",".privateAboutYourInnovation-innovator-notAnswered",".privateAboutYourInnovation-claimed-notAnswered", ".privateAboutYourInnovation-notAnswered-notClaimed", ".innovator-question"]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPrivateNotansweredNotclaimedAboutYourInnovation(medigyAuthServicePolicies, answerStatus,"{{ $claimStatus}}", session, visible=[".privateAboutYourInnovation-notAnswered-notClaimed"], hidden=[".publicAboutYourInnovation-notAnswer",".publicAboutYourInnovation",".publicAboutYourInnovation-answered",".privateAboutYourInnovation-innovator-answered",".privateAboutYourInnovation-innovator-notAnswered",".privateAboutYourInnovation-claimed-notAnswered",".privateAboutYourInnovation-answered-claimed"], disableData=[]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPublicNotclaimedAboutYourInnovation(medigyAuthServicePolicies, "{{ $claimStatus}}", session, disableData=["#{{$id_first}}-{{ $questionCode}}","#{{$id_second}}-{{ $questionCode}}"], addClassData=["#{{$id_first}}-{{ $questionCode}}","#{{$id_second}}-{{ $questionCode}}"]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanNotansweredClaimedAboutYourInnovation(medigyAuthServicePolicies, answerStatus, "{{ $claimStatus}}", "{{ $vendorId}}", session, disableData=["#{{$id_first}}-{{ $questionCode}}","#{{$id_second}}-{{ $questionCode}}"], addClassData=["#{{$id_first}}-{{ $questionCode}}","#{{$id_second}}-{{ $questionCode}}"]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanNotclaimedAboutYourInnovation(medigyAuthServicePolicies, answerStatus, "{{ $claimStatus}}", "{{ $vendorId}}", session, disableData=["#{{$id_first}}-{{ $questionCode}}","#{{$id_second}}-{{ $questionCode}}"], addClassData=["#{{$id_first}}-{{ $questionCode}}","#{{$id_second}}-{{ $questionCode}}"]);
            
            setTimeout(function(){
              medigyAuthServiceActions.makeVisibleIfQuestionNoneAnswerNoneAboutYourInnovation(".answer-{{ .questionCode}}", ".question-{{ .questionCode}}");

            }, 2000);

          }
          medigyAuthServiceActions.makeVisibleIfNotAnswered("#answerStatus", hidden=["#icon-answered-date-{{ .questionCode}}"]);      
          });       
        /// Get data ends here ////

          $('#edit-btn-{{ .questionCode}}').click(function(){
            $("#edit-badge-{{ .questionCode}}").show();
          });
          $('#close-btn-{{ .questionCode}}').click(function(){
            $("#edit-badge-{{ .questionCode}}").hide();
          });

        /// Yes Push data starts here ////
          $("#{{$id_first}}-{{ .questionCode }}, #edit-{{$id_first}}-{{ .questionCode }}").on("click", function (e) {   
            var personid = getCookie('personid');
            var userEmail = getCookie('userEmail');
            var product_Name = $(this).attr('data-title');      
            var btn_label = $(this).attr('data-label');  
            var answerText = $(this).attr('data-text');
            var addUpdateStatus = ($(this).attr('data-action')) ? $(this).attr('data-action') : "Add";
            var updatedPerson = getCookie('firstname')+" "+getCookie('lastname');
            gtmAddproduct(product_Name,userEmail); 
            if( personid != '' && personid != null && getCookie('sessionId')!= null && getCookie('sessionId')!= '' ) {         
              var timestamp = Date.now();
              var institutionId = $(this).attr('data-id');
              var source = "hospital-compare-"+institutionId;
              var selectedVal = btn_label;
              var answerText = answerText;
              updatedDate = new Date(timestamp);
              var months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
              var currentMonth= months[updatedDate.getMonth()];
              var date = updatedDate.getDate();
              var year = updatedDate.getFullYear(); 
              var answeredDate = currentMonth+" "+date+", "+year; 
              var metricName ="medigy_qual_exp_institution_inno_"+$(this).attr('data-metric');
              var settings = {
                "async": true,
                "crossDomain": true,
                "url": "{{ $.Site.Params.GraphQLUrl }}",
                "method": "POST",
                "headers": {
                  "Content-Type": "application/x-www-form-urlencoded",
                  "Accept": "*/*",
                  "Cache-Control": "no-cache",
                  "Connection": "keep-alive"
                },
                "data": {
                  "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"institutionId\", \n        value: \""+institutionId+"\"\n      }, \n      {\n        key: \"updatedPerson\", \n        value: \""+updatedPerson+"\"\n      }, \n      {\n        key: \"addUpdateStatus\", \n        value: \""+addUpdateStatus+"\"\n      }, \n      {\n        key: \"selectedVal\", \n        value: \""+selectedVal+"\"\n      }, \n      {\n        key: \"updatedDate\", \n        value: \""+updatedDate+"\"\n      }, \n      {\n        key: \"answerText\", \n        value: \""+answerText+"\"\n      }, \n      {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"createdat\", \n        value: \""+timestamp+"\"\n      }, \n      {\n        key: \"userId\", \n        value: \""+personid+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+ metricName +"\", \n    metricName: \""+metricName+"\") {\n    status\n    message\n    errorCode\n  }\n}"
                }
              }
             $.ajax(settings).done(function (response) {      
             if(response.data.addPrometheusData.status == "SUCCESS")
                $("#text-{{ .questionCode}}").text(answerText);
                $("#btn-{{ .questionCode}}").hide(); 
                $("#question-updated-on-{{ .questionCode}}").text("Updated on "+answeredDate+ " by Senior Executive at "+ {{ $instName}});   
                $("#edit-badge-{{ .questionCode}}").hide();
                $("#edit-{{$id_first}}-{{ $questionCode}}").attr("disabled", true);
                $("#edit-{{$id_second}}-{{ $questionCode}}").attr("disabled", false);
              });
            }
            else{
              if (getCookie('personid') == null)
              $('#loginModalCenter').modal('toggle');
              else
              $('#reLoginModalCenter').modal('toggle');
            }
          });
        /// Yes Push data ends here ////
      
        /// No push data starts here
          $("#{{$id_second}}-{{ .questionCode }}, #edit-{{$id_second}}-{{ .questionCode }}").on("click", function (e) {   
            var personid = getCookie('personid');
            var userEmail = getCookie('userEmail');
            var product_Name = $(this).attr('data-title');      
            var btn_label = $(this).attr('data-label');  
            var answerText = $(this).attr('data-text');   
            var addUpdateStatus = ($(this).attr('data-action')) ? $(this).attr('data-action') : "Add";
            var updatedPerson = getCookie('firstname')+" "+getCookie('lastname');   
            gtmAddproduct(product_Name,userEmail); 
            if( personid != '' && personid != null && getCookie('sessionId')!= null && getCookie('sessionId')!= '' ) {         
              var timestamp = Date.now();
              var institutionId = $(this).attr('data-id');
              var source = "hospital-compare-"+institutionId;
              var selectedVal = btn_label;
              var answerText = answerText;
              updatedDate = new Date(timestamp);
              var months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
              var currentMonth= months[updatedDate.getMonth()];
              var date = updatedDate.getDate();
              var year = updatedDate.getFullYear(); 
              var answeredDate = currentMonth+" "+date+", "+year;
              var metricName ="medigy_qual_exp_institution_inno_"+$(this).attr('data-metric');
              var settings = {
                "async": true,
                "crossDomain": true,
                "url": "{{ $.Site.Params.GraphQLUrl }}",
                "method": "POST",
                "headers": {
                  "Content-Type": "application/x-www-form-urlencoded",
                  "Accept": "*/*",
                  "Cache-Control": "no-cache",
                  "Connection": "keep-alive"
                },
                "data": {
                  "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"institutionId\", \n        value: \""+institutionId+"\"\n      }, \n      {\n        key: \"updatedPerson\", \n        value: \""+updatedPerson+"\"\n      }, \n      {\n        key: \"addUpdateStatus\", \n        value: \""+addUpdateStatus+"\"\n      }, \n      {\n        key: \"selectedVal\", \n        value: \""+selectedVal+"\"\n      }, \n      {\n        key: \"answerText\", \n        value: \""+answerText+"\"\n      }, \n      {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"createdat\", \n        value: \""+timestamp+"\"\n      }, \n      {\n        key: \"userId\", \n        value: \""+personid+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+ metricName +"\", \n    metricName: \""+metricName+"\") {\n    status\n    message\n    errorCode\n  }\n}"
                }
              }
              $.ajax(settings).done(function (response) {       
              if(response.data.addPrometheusData.status == "SUCCESS")
                $("#text-{{ .questionCode}}").text(answerText);
                $("#btn-{{ .questionCode}}").hide();
                $("#question-updated-on-{{ .questionCode}}").text("Updated on "+answeredDate+ " by Senior Executive at "+ {{ $instName}});       
                $("#edit-badge-{{ .questionCode}}").hide();
                $("#edit-{{$id_first}}-{{ $questionCode}}").attr("disabled", false);
                $("#edit-{{$id_second}}-{{ $questionCode}}").attr("disabled", true);
              });
            }
            else{
              if (getCookie('personid') == null)
              $('#loginModalCenter').modal('toggle');
              else
              $('#reLoginModalCenter').modal('toggle');
            }
          });
        /// No push data ends here

        /// Endorse Button
        /// Get data on page load starts here ////
          var metricName =  "medigy_qual_exp_institution_inno_answer_{{ .localQuestionCode}}"; 
          var institutionId = "{{ $instId }}";
          var settings = {
              "async": true,
              "crossDomain": true,
              "url": "{{ $.Site.Params.GraphQLUrl }}",
              "method": "POST",
              "headers": {
                "Content-Type": "application/x-www-form-urlencoded",
                "Accept": "*/*",
                "Cache-Control": "no-cache",
                "Connection": "keep-alive"
              },
              "data": {
                "query": "query{\n  getPromData(metricName:\""+ metricName +"\",metricQuery:\"{institutionId=\\\""+institutionId+"\\\"}[1y]\",groupByParam:[\"userId\",\"institutionId\"]){\n    prometheusData\n    status\n  }\n}"
              }
          } 
          $.ajax(settings).done(function (response) {
            if(response.data.getPromData.status == "success"){
              var JSONData = JSON.parse(response.data.getPromData.prometheusData);
              var userArray = JSONData.filter(function (el) {
                return el.userId == getCookie('personid')
              });
              if(JSONData.length > 0){
                var yescount=0;
                var nocount=0;
                for(i =0; i< (JSONData.length);i++)
                {
                  if(JSONData[i]['selectedVal'] == "1" || JSONData[i]['selectedVal'] == "01")
                    yescount++;  
                  else if (JSONData[i]['selectedVal'] == "0" || JSONData[i]['selectedVal'] == "02")
                    nocount++;                   
                }
                $('#{{ .questionCode }}-agree-count').html(yescount);
                $('#{{ .questionCode }}-disagree-count').html(nocount);
                for(var i=0; i<userArray.length; i++){		
                  if (userArray[i].userId == getCookie('personid')){
                    if(JSONData[i]['selectedVal'] == "1" || JSONData[i]['selectedVal'] == "01")
                      $('#agree-{{ .questionCode}}').prop('disabled', true);
                    else
                      $('#disagree-{{ .questionCode}}').prop('disabled', true);
                  }
                }
              }
            }             
          });
        /// Get data ends here ////

        /// Endorse Push data starts here ////
          $("#agree-{{ .questionCode }}").on("click", function (e) {  
            $('#agree-{{ .questionCode}}').prop('disabled', true);
            var personid = getCookie('personid');
            var userEmail = getCookie('userEmail');
            var product_Name = $(this).attr('data-title');      
            gtmAddproduct(product_Name,userEmail); 
            if( personid != '' && personid != null && getCookie('sessionId')!= null && getCookie('sessionId')!= '' ) {         
              var timestamp = Date.now();
              var institutionId = $(this).attr('data-id');
              var source = "hospital-compare-"+institutionId;
              var selectedVal = "1";
              var metricName ="medigy_qual_exp_institution_inno_answer_"+$(this).attr('data-metric');
              var settings = {
                "async": true,
                "crossDomain": true,
                "url": "{{ $.Site.Params.GraphQLUrl }}",
                "method": "POST",
                "headers": {
                  "Content-Type": "application/x-www-form-urlencoded",
                  "Accept": "*/*",
                  "Cache-Control": "no-cache",
                  "Connection": "keep-alive"
                },
                "data": {
                  "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"institutionId\", \n        value: \""+institutionId+"\"\n      }, \n      {\n        key: \"selectedVal\", \n        value: \""+selectedVal+"\"\n      }, \n      {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"createdat\", \n        value: \""+timestamp+"\"\n      }, \n      {\n        key: \"userId\", \n        value: \""+personid+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+ metricName +"\", \n    metricName: \""+metricName+"\") {\n    status\n    message\n    errorCode\n  }\n}"
                }
              }
              $.ajax(settings).done(function (response) {
                if(response.data.addPrometheusData.status == "SUCCESS"){
                  var currentyescount=$('#{{ .questionCode }}-agree-count').html();
                  currentyescount++;
                  $('#{{ .questionCode }}-agree-count').html(currentyescount);
                  var buttonstatus=   $('#disagree-{{ .questionCode}}').is(':disabled');              
                  if(buttonstatus==true){
                      var currentnocount=$('#{{ .questionCode }}-disagree-count').html(); 
                      currentnocount=currentnocount-1;
                      $('#{{ .questionCode }}-disagree-count').html(currentnocount); 
                      $('#disagree-{{ .questionCode}}').prop('disabled', false);
                      $('#agree-{{ .questionCode}}').prop('disabled', true);
                  }                     
                }          
              });
            }
            else{
              if (getCookie('personid') == null)
              $('#loginModalCenter').modal('toggle');
              else
              $('#reLoginModalCenter').modal('toggle');
            }
          });
        /// Endorse Push data ends here ////
      </script>
    {{ end }}   
    {{ if (gt (.answers | len) 2) }}
      <article class="yes-no-row inn-click "> 
        <form name="form{{ .questionCode }}" id="form{{ .questionCode }}"  class="innovator-question question-{{ .questionCode}} ">
          <div class="row">    
            <div class="col-md-6">
              <i class="{{ .prefix }} icon-position-1"></i>
              <h4 class="pl-5 normal-heading" id="text-{{ .questionCode}}">{{ .question }}</h4>
            </div> 
            <div id="icon-answered-date-{{ .questionCode}}"  class="col-md-4 ans-update-date icon-{{ .questionCode}}">
              <i  class="far fa-clock icon-position-1"></i>
              <p id="question-updated-on-{{ .questionCode}}" class="pl-5"></p>
            </div>
            <div id="icon-answered-date-{{ .questionCode}}" class="col-md-2 ans-update-date icon-{{ .questionCode}} edit-{{ .questionCode}}" style="display:none;">
              <a class="update-btn-edit" id="edit-btn-{{ .questionCode}}" href="javascript:void(0)"><i class="far fa-edit icon-position-1"></i>
              <span id="question-updated-on-{{ .questionCode}}" class="pl-5">Edit</span></a>          
            </div>
            <!--Edit Badge section in innovator login screen starts-->
            <div class="alert alert-secondary innovator-edit-box" id="edit-badge-{{ .questionCode}}" style="display:none">
              <div class="col-md-6">
                <i class="{{ .prefix }} icon-position-1"></i>
                <h4 class="pl-5 normal-heading" id="text-{{ .questionCode}}">{{ .question }}</h4>
              </div> 
              <div class="col-md-5">
                {{ $questionCode := .questionCode}}
                {{ range .answers }}               
                  <div class="col-md-12">
                    <div class="radio-position edit-radio{{$questionCode}}">    
                      <input class='form-check-input inno-rad edit-rad-input{{ $questionCode }}' type='radio' name='edit-input{{ $questionCode }}' id='edit-{{ .text }}' value='{{ .code }}' data-action="update">
                      <label class='form-check-label' for='edit-{{ .text }}' > {{ .text }}</label>
                    </div>
                  </div>
                {{ end }} 
                </div>          
                <button type="button" class="close" id="close-btn-{{ .questionCode}}" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>              
            </div>
            <!--Edit Badge section in innovator login screen ends-->
            <div class="col-md-6">
              {{ $questionCode := .questionCode}}
              {{ range .answers }}
                <div class="col-md-12">
                  <div class="radio-position radio{{$questionCode}}">
                    <input class='form-check-input inno-rad rad-input{{ $questionCode }}' type='radio' name='input{{ $questionCode }}' id='{{ .text }}' value='{{ .code }}' >
                    <label class='form-check-label' for='{{ .text }}' > {{ .text }}</label>
                  </div>
                </div>
              {{ end }}
            </div>
          </div>
        </form>
        <div class="row innovator-answer answer-{{ .questionCode}} " style="display: none;">
          <div class="col-md-6">
            <div class="icon-space-left-1">
              <i class="{{ .prefix }} icon-position-1"></i>
              <h4 id="text-answer-{{ .questionCode}}" class="normal-heading" ></h4>
            </div>
          </div>
          <div class="col-md-4 ans-update-date icon-{{ .questionCode}}" >
            <i class="far fa-clock icon-position-1"></i>
            <p id="answer-updated-on-{{ .questionCode}}" class="pl-5"></p>
          </div>
          <div id="btn-answer-{{ .questionCode}}" class="col-md-2 text-right">
            <button class="new-ofer-btn-1 yes btn white agree-btn" title="I Endorse that" id="agree-{{ .questionCode}}" type="button" data-title="{{ $instName }}" data-id="{{ $instId}}" data-metric="{{ .localQuestionCode}}">Endorse (<span class="" id="{{ .questionCode }}-agree-count">0</span>)</button>
          </div>
        </div>
      </article>
      <script>
          $('#edit-btn-{{ .questionCode}}').click(function(){
            $("#edit-badge-{{ .questionCode}}").show();
          });
          $('#close-btn-{{ .questionCode}}').click(function(){
            $("#edit-badge-{{ .questionCode}}").hide();
          });
        /// Get data on page load starts here ////
          var metricName =  "medigy_qual_exp_institution_inno_{{ .localQuestionCode}}"; 
          var institutionId = "{{ $instId }}";
          var settings = {
            "async": true,
            "crossDomain": true,
            "url": "{{ $.Site.Params.GraphQLUrl }}",
            "method": "POST",
            "headers": {
              "Content-Type": "application/x-www-form-urlencoded",
              "Accept": "*/*",
              "Cache-Control": "no-cache",
              "Connection": "keep-alive"
            },
            "data": {
              "query": "query{\n  getPromData(metricName:\""+ metricName +"\",metricQuery:\"{institutionId=\\\""+institutionId+"\\\"}[1y]\",groupByParam:[\"userId\",\"institutionId\"]){\n    prometheusData\n    status\n  }\n}"
            }
          } 
          $.ajax(settings).done(function (response) {
            if(response.data.getPromData.status == "success"){
              var JSONData = JSON.parse(response.data.getPromData.prometheusData);  
              var questionCode = {{ .questionCode }};
              if(JSONData.length > 0){
                for(i =0; i< (JSONData.length);i++){
                  timestamp = JSONData[i]['time'];       
                  updatedDate = new Date(timestamp * 1000);
                  var months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
                  var currentMonth= months[updatedDate.getMonth()];
                  var date = updatedDate.getDate();
                  var year = updatedDate.getFullYear(); 
                  var answeredDate = currentMonth+" "+date+", "+year;                  
                  var labelStatus = "Answered on ";
                  if(JSONData[i]['addUpdateStatus'])
                    (JSONData[i]['addUpdateStatus']=="update") ? labelStatus= "Updated on " : labelStatus = "Answered on ";
                  {{ range .answers }}        
                    if(JSONData[i]['inputvalue'] == "{{.code}}"){ 
                      $("#text-"+questionCode).text("{{.code}}");
                      $("#text-answer-"+questionCode).text("{{.code}}");
                      $("#answer-updated-on-"+questionCode).text(labelStatus+answeredDate+ " by Senior Executive at "+ {{ $instName}});
                      $("#question-updated-on-"+questionCode).text(labelStatus+answeredDate+ " by Senior Executive at "+ {{ $instName}});
                      $(".radio"+questionCode).hide();
                      $(".edit-rad-input"+questionCode+'[value="{{.code}}"]').attr('disabled', 'disabled');
                    }
                  {{ end }}                
                }             
                $('#answerStatus').val(1);
                if(getCookie('personid') != null && $('#answerStatus').val() ==1 && {{ $claimStatus}} == true && getCookie('personid') != "{{ $vendorId}}")
                  $(".answer-{{ .questionCode}}").show(); 
                 
              }
              else{
                $('#answerStatus').val(0);
                $(".radio"+questionCode).show();
              }            
            }

            var answerStatus = $('#answerStatus').val();
            var session = {"personId":getCookie('personid'),"sessionId":getCookie('sessionId'),"sessionUser":getCookie('firstname')};
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPublicAnsweredAboutYourInnovation(medigyAuthServicePolicies, answerStatus, session, visible=[".publicAboutYourInnovation-answered"], hidden=[".publicAboutYourInnovation-notAnswer",".publicAboutYourInnovation",".privateAboutYourInnovation-innovator-notAnswered",".privateAboutYourInnovation-claimed-notAnswered",".privateAboutYourInnovation-answered-claimed",".privateAboutYourInnovation-notAnswered-notClaimed",".privateAboutYourInnovation-innovator-answered"]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPrivateNotansweredClaimedInnovatorAboutYourInnovation(medigyAuthServicePolicies, answerStatus, "{{ $vendorId}}", session, visible=[".privateAboutYourInnovation-innovator-notAnswered"], hidden=[".publicAboutYourInnovation-notAnswer",".publicAboutYourInnovation",".publicAboutYourInnovation-answered",".privateAboutYourInnovation-claimed-notAnswered",".privateAboutYourInnovation-answered-claimed",".privateAboutYourInnovation-notAnswered-notClaimed",".privateAboutYourInnovation-innovator-answered"]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPrivateAnsweredInnovatorAboutYourInnovation(medigyAuthServicePolicies, answerStatus, "{{ $vendorId}}","{{ .questionCode}}", session, visible=[".privateAboutYourInnovation-innovator-answered"], hidden=[".publicAboutYourInnovation-notAnswer",".publicAboutYourInnovation",".publicAboutYourInnovation-answered",".privateAboutYourInnovation-innovator-notAnswered",".privateAboutYourInnovation-claimed-notAnswered",".privateAboutYourInnovation-answered-claimed",".privateAboutYourInnovation-notAnswered-notClaimed"]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPrivateNotansweredClaimedNotinnovatorAboutYourInnovation(medigyAuthServicePolicies, answerStatus,"{{ $claimStatus}}", "{{ $vendorId}}", session, visible=[".privateAboutYourInnovation-claimed-notAnswered"], hidden=[".publicAboutYourInnovation-notAnswer",".publicAboutYourInnovation",".publicAboutYourInnovation-answered",".privateAboutYourInnovation-innovator-answered", ".privateAboutYourInnovation-innovator-notAnswered",".privateAboutYourInnovation-answered-claimed",".privateAboutYourInnovation-notAnswered-notClaimed"], disableData=["input[name=input{{ $questionCode }}]"], addClassData=[]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPrivateAnsweredNotinnovatorAboutYourInnovation(medigyAuthServicePolicies, answerStatus, "{{ $vendorId}}", "{{ .questionCode}}",session, visible=[".privateAboutYourInnovation-answered-claimed"], hidden=[".publicAboutYourInnovation-notAnswer", ".publicAboutYourInnovation",".publicAboutYourInnovation-answered",".privateAboutYourInnovation-innovator-answered",".privateAboutYourInnovation-innovator-notAnswered",".privateAboutYourInnovation-claimed-notAnswered", ".privateAboutYourInnovation-notAnswered-notClaimed", ".innovator-question"]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPrivateNotansweredNotclaimedAboutYourInnovation(medigyAuthServicePolicies, answerStatus,"{{ $claimStatus}}", session, visible=[".privateAboutYourInnovation-notAnswered-notClaimed"], hidden=[".publicAboutYourInnovation-notAnswer",".publicAboutYourInnovation",".publicAboutYourInnovation-answered",".privateAboutYourInnovation-innovator-answered",".privateAboutYourInnovation-innovator-notAnswered",".privateAboutYourInnovation-claimed-notAnswered",".privateAboutYourInnovation-answered-claimed"], disableData=["input[name=input{{ $questionCode }}]"]);            
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPublicNotclaimedAboutYourInnovation(medigyAuthServicePolicies, "{{ $claimStatus}}", session, disableData=["input[name=input{{ $questionCode }}]"], addClassData=[]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanNotansweredClaimedNotinnovatorAboutYourInnovation(medigyAuthServicePolicies, answerStatus,"{{ $claimStatus}}", "{{ $vendorId}}", session,  disableData=["input[name=input{{ $questionCode }}]"]);

           
            setTimeout(function(){
              medigyAuthServiceActions.makeVisibleIfQuestionNoneAnswerNoneAboutYourInnovation(".answer-{{ .questionCode}}", ".question-{{ .questionCode}}");

            }, 2000);
            medigyAuthServiceActions.makeVisibleIfNotAnswered("#answerStatus", hidden=["#icon-answered-date-{{ .questionCode}}"]);      
            

          });
        /// Get data ends here ////

        $('.rad-input{{ .questionCode }}, .edit-rad-input{{ .questionCode }}').change(function(e){   
          e.preventDefault();          
          var inputvalue =  $(this).val();
          var productId = "{{ $instId }}";
          var source = "hospital-compare-"+productId;
          var metricName ="medigy_qual_exp_institution_inno_"+"{{ .localQuestionCode }}";
          var personId = getCookie('personid');
          var addUpdateStatus = ($(this).attr('data-action')) ? $(this).attr('data-action') : "Add";
          var updatedPerson = getCookie('firstname')+" "+getCookie('lastname');
          var timestamp = Date.now();
          updatedDate = new Date(timestamp);
          var months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
          var currentMonth= months[updatedDate.getMonth()];
          var date = updatedDate.getDate();
          var year = updatedDate.getFullYear(); 
          var answeredDate = currentMonth+" "+date+", "+year;                 
          if( personId != '' && personId != null && getCookie('sessionId')!= null && getCookie('sessionId')!= '' ) { 
              var settings = {
                "async": true,
                "crossDomain": true,
                "url": "{{ $.Site.Params.GraphQLUrl }}",
                "method": "POST",
                "headers": {
                  "Content-Type": "application/x-www-form-urlencoded",
                  "Accept": "*/*",
                  "Cache-Control": "no-cache",
                  "Connection": "keep-alive"
                },
                "data": {
                  "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"institutionId\", \n        value: \""+"{{ $instId}}"+"\"\n      }, \n     {\n        key: \"inputvalue\", \n        value: \""+inputvalue+"\"\n      }, \n      {\n        key: \"updatedDate\", \n        value: \""+updatedDate+"\"\n      }, \n      {\n        key: \"updatedPerson\", \n        value: \""+updatedPerson+"\"\n      }, \n      {\n        key: \"addUpdateStatus\", \n        value: \""+addUpdateStatus+"\"\n      }, \n     {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"userId\", \n        value: \""+personId+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+metricName+"\", \n    metricName: \""+metricName+"\") {\n    status\n    message\n    errorCode\n  }\n}" 
                }
              }
              $.ajax(settings).done(function (response) {                 
                if(response.data.addPrometheusData.status == "SUCCESS"){
                  {{ range .answers }}           
                    if(inputvalue == "{{.code}}")
                      var answer = "{{.code}}"
                  {{ end }}                   
                  $("#text-{{ .questionCode }}").text(answer);
                  $(".radio{{ .questionCode }}").hide();
                  $("#question-updated-on-{{ .questionCode}}").text("Updated on "+answeredDate+ " by Senior Executive at "+ {{ $instName}});   
                  $("#edit-badge-{{ .questionCode}}").hide();
                  $('input[name=edit-input{{ .questionCode }}]').attr("disabled",false);
                 } 
              });
          }
          else{
            if (getCookie('personid') == null)
            $('#loginModalCenter').modal('toggle');
            else
            $('#reLoginModalCenter').modal('toggle');
          }  
        });
        /// Endorse Button acse
        /// Get data on page load starts here ////
          var metricName =  "medigy_qual_exp_institution_inno_answer_{{ .localQuestionCode}}"; 
          var institutionId = "{{ $instId }}";
          var settings = {
              "async": true,
              "crossDomain": true,
              "url": "{{ $.Site.Params.GraphQLUrl }}",
              "method": "POST",
              "headers": {
                "Content-Type": "application/x-www-form-urlencoded",
                "Accept": "*/*",
                "Cache-Control": "no-cache",
                "Connection": "keep-alive"
              },
              "data": {
                "query": "query{\n  getPromData(metricName:\""+ metricName +"\",metricQuery:\"{institutionId=\\\""+institutionId+"\\\"}[1y]\",groupByParam:[\"userId\",\"institutionId\"]){\n    prometheusData\n    status\n  }\n}"
              }
            } 
        
            $.ajax(settings).done(function (response) {
            if(response.data.getPromData.status == "success"){
              var JSONData = JSON.parse(response.data.getPromData.prometheusData);
              var userArray = JSONData.filter(function (el) {
                  return el.userId == getCookie('personid')
              });
              if(JSONData.length > 0){
                var yescount=0;
                var nocount=0;
                for(i =0; i< (JSONData.length);i++)
                {
                  if(JSONData[i]['selectedVal'] == "1")
                      yescount++;  
                  else if (JSONData[i]['selectedVal'] == "0")
                      nocount++;                   
                }
                $('#{{ .questionCode }}-agree-count').html(yescount);
                $('#{{ .questionCode }}-disagree-count').html(nocount);
                for(var i=0; i<userArray.length; i++){		
                  if (userArray[i].userId == getCookie('personid')){
                    if(JSONData[i]['selectedVal'] == "1")
                    $('#agree-{{ .questionCode}}').prop('disabled', true);
                    else
                    $('#disagree-{{ .questionCode}}').prop('disabled', true);
                  }
                }
              }
            }
          });
        /// Get data ends here ////

        /// Endorse Push data starts here ////
          $("#agree-{{ .questionCode }}").on("click", function (e) {  
            $('#agree-{{ .questionCode}}').prop('disabled', true);
            var personid = getCookie('personid');
            var userEmail = getCookie('userEmail');
            var product_Name = $(this).attr('data-title');      
            gtmAddproduct(product_Name,userEmail); 
            if( personid != '' && personid != null && getCookie('sessionId')!= null && getCookie('sessionId')!= '' ) {         
              var timestamp = Date.now();
              var institutionId = $(this).attr('data-id');
              var source = "hospital-compare-"+institutionId;
              var selectedVal = "1";
              var metricName ="medigy_qual_exp_institution_inno_answer_"+$(this).attr('data-metric');
              var settings = {
                "async": true,
                "crossDomain": true,
                "url": "{{ $.Site.Params.GraphQLUrl }}",
                "method": "POST",
                "headers": {
                  "Content-Type": "application/x-www-form-urlencoded",
                  "Accept": "*/*",
                  "Cache-Control": "no-cache",
                  "Connection": "keep-alive"
                },
                "data": {
                  "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"institutionId\", \n        value: \""+institutionId+"\"\n      }, \n      {\n        key: \"selectedVal\", \n        value: \""+selectedVal+"\"\n      }, \n      {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"createdat\", \n        value: \""+timestamp+"\"\n      }, \n      {\n        key: \"userId\", \n        value: \""+personid+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+ metricName +"\", \n    metricName: \""+metricName+"\") {\n    status\n    message\n    errorCode\n  }\n}"
                }
              }
              $.ajax(settings).done(function (response) {
                if(response.data.addPrometheusData.status == "SUCCESS"){
                  var currentyescount=$('#{{ .questionCode }}-agree-count').html();
                  currentyescount++;
                  $('#{{ .questionCode }}-agree-count').html(currentyescount);
                  var buttonstatus=   $('#disagree-{{ .questionCode}}').is(':disabled');              
                    if(buttonstatus==true){
                      var currentnocount=$('#{{ .questionCode }}-disagree-count').html(); 
                      currentnocount=currentnocount-1;
                      $('#{{ .questionCode }}-disagree-count').html(currentnocount); 
                      $('#disagree-{{ .questionCode}}').prop('disabled', false);
                      $('#agree-{{ .questionCode}}').prop('disabled', true);
                    }                     
                }          
              });
            }
            else{
              if (getCookie('personid') == null)
              $('#loginModalCenter').modal('toggle');
              else
              $('#reLoginModalCenter').modal('toggle');
            }
          });
        /// Endorse Push data ends here ////       
      </script>
    {{ end }}
  {{ end }}
  {{ if eq .dataType "ST" }}
    <article class="yes-no-row inn-click "> 
      <form name="form{{ .questionCode }}" id="{{ .questionCode }}"  class="innovator-question question-{{ .questionCode}} ">
        <div class="row">
          <div class="col-md-6">
            <i class="{{ .prefix }} icon-position-1"></i><h4 id="text-{{ .questionCode}}" class="pl-5 normal-heading">{{ .question}}</h4>
          </div> 
          <div id="icon-answered-date-{{ .questionCode}}" class="col-md-4 ans-update-date icon-{{ .questionCode}}">
            <i class="far fa-clock icon-position-1"></i>
            <p id="question-updated-on-{{ .questionCode}}" class="pl-5"></p>
          </div>
          <div id="icon-answered-date-{{ .questionCode}}" class="col-md-2 ans-update-date icon-{{ .questionCode}} edit-{{ .questionCode}}" style="display:none;">
            <a class="update-btn-edit" id="edit-btn-{{ .questionCode}}" href="javascript:void(0)"><i class="far fa-edit icon-position-1"></i>
            <span id="question-updated-on-{{ .questionCode}}" class="pl-5">Edit</span></a>          
          </div>
          <!--Edit Badge section in innovator login screen starts-->
          <div class="alert alert-secondary innovator-edit-box" id="edit-badge-{{ .questionCode}}" style="display:none">
            <div class="row">
            <div class="col-md-6">
              <i class="{{ .prefix }} icon-position-1"></i><h4 id="text-{{ .questionCode}}" class="pl-5 normal-heading">{{ .question}}</h4>
            </div> 
            <div class="col-md-5">     
              <input class="form-control edit-field{{.questionCode}}" name="edit-input{{ .questionCode }}" id="edit-input{{ .questionCode }}"  />
              <div class="text-left">
                  <input type="submit" value="Submit" id="edit-submit-btn-{{ .questionCode }}" class="btn btn-primary q-btn-1 mt-2" data-action="update" data-title="{{ $instName }}" data-metric="{{ .localQuestionCode }}" productid="{{ $instId }}" style="display:none">
              </div>
            </div>
            <button type="button" class="close" id="close-btn-{{ .questionCode}}" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
            </div>
          </div>
          <!--Edit Badge section in innovator login screen ends-->
          <div class="col-md-6">     
            <input class="form-control field{{.questionCode}}" name="input{{ .questionCode }}" id="input{{ .questionCode }}"  />
            <div class="text-left">
                <input type="submit" value="Submit" id="btn-{{ .questionCode }}" class="btn btn-primary q-btn-1 mt-2" data-title="{{ $instName }}" data-metric="{{ .localQuestionCode }}" productid="{{ $instId }}" style="display:none">
            </div>
          </div>
        </div>
      </form>
      <div class="row innovator-answer answer-{{ .questionCode}} " style="display: none;">
        <div class="col-md-6">
          <div class="icon-space-left-1">
            <i class="{{ .prefix }} icon-position-1"></i>
            <h4 id="text-answer-{{ .questionCode}}" class="normal-heading"></h4>
          </div>
        </div>
        <div class="col-md-4 ans-update-date icon-{{ .questionCode}}" >
          <i class="far fa-clock icon-position-1"></i>
          <p id="answer-updated-on-{{ .questionCode}}" class="pl-5"></p>
        </div>
        <div id="btn-answer-{{ .questionCode}}" class="col-md-2 text-right">
          <button class="new-ofer-btn-1 yes btn white agree-btn" title="I Endorse that" id="agree-{{ .questionCode}}" type="button" data-title="{{ $instName }}" data-id="{{ $instId}}" data-metric="{{ .localQuestionCode}}">Endorse (<span class="" id="{{ .questionCode }}-agree-count">0</span>)</button>
        </div>
      </div>
    </article>
    <script> 
      $('#edit-btn-{{ .questionCode}}').click(function(){
        $("#edit-badge-{{ .questionCode}}").show();
      });
      $('#close-btn-{{ .questionCode}}').click(function(){
        $("#edit-badge-{{ .questionCode}}").hide();
      });
      var institutionId = "{{ $instId }}";
      var metricName =  "medigy_qual_exp_institution_inno_{{ .localQuestionCode}}"; 
      var settings = {
      "async": true,
      "crossDomain": true,
      "url": "{{ $.Site.Params.GraphQLUrl }}",
      "method": "POST",
      "headers": {
        "Content-Type": "application/x-www-form-urlencoded",
        "Accept": "*/*",
        "Cache-Control": "no-cache",
        "Connection": "keep-alive"
      },
      "data": {
        "query": "query{ getPromData(metricName:\""+metricName+"\",metricQuery:\"{institutionId=\\\""+institutionId+"\\\"}[1y]\",groupByParam:[\"userId\",\"institutionId\"]){prometheusData   status}}"
          }
      }
      $.ajax(settings).done(function (Response) {  
        if(Response.data.getPromData.status == "success"){
          var JSONData = JSON.parse(Response.data.getPromData.prometheusData); 
          if(JSONData.length > 0 ){  
            for(i =0; i< (JSONData.length);i++){ 
              timestamp = JSONData[i]['time'];       
              updatedDate = new Date(timestamp * 1000);
              var months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
              var currentMonth= months[updatedDate.getMonth()];
              var date = updatedDate.getDate();
              var year = updatedDate.getFullYear(); 
              var answeredDate = currentMonth+" "+date+", "+year;              
              var labelStatus = "Answered on ";
              if(JSONData[i]['addUpdateStatus'])
                (JSONData[i]['addUpdateStatus']=="update") ? labelStatus= "Updated on " : labelStatus = "Answered on ";     
              $("#text-{{ .questionCode}}").text("{{.defaultAnswer}}"+" "+ JSONData[i]['inputvalue']);
              $("#btn-{{ .questionCode}}").hide();
              $(".field{{ .questionCode}}").hide();  
              $("#text-answer-{{ .questionCode}}").text("{{.defaultAnswer}}"+" "+JSONData[i]['inputvalue']);   
              $("#answer-updated-on-{{ .questionCode}}").text(labelStatus+answeredDate+ " by Senior Executive at "+ {{ $instName}});
              $("#question-updated-on-{{ .questionCode}}").text(labelStatus+answeredDate+ " by Senior Executive at "+ {{ $instName}});                                                                                                                    
            }   
            $('#answerStatus').val(1);
            if(getCookie('personid') != null && $('#answerStatus').val() ==1 && {{ $claimStatus}} == true && getCookie('personid') != "{{ $vendorId}}")
              $(".answer-{{ .questionCode}}").show();  

          }
          else
            $('#answerStatus').val(0);
        }
        var answerStatus = $('#answerStatus').val();
            var session = {"personId":getCookie('personid'),"sessionId":getCookie('sessionId'),"sessionUser":getCookie('firstname')};
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPublicAnsweredAboutYourInnovation(medigyAuthServicePolicies, answerStatus, session, visible=[".publicAboutYourInnovation-answered"], hidden=[".publicAboutYourInnovation-notAnswer",".publicAboutYourInnovation",".privateAboutYourInnovation-innovator-notAnswered",".privateAboutYourInnovation-claimed-notAnswered",".privateAboutYourInnovation-answered-claimed",".privateAboutYourInnovation-notAnswered-notClaimed",".privateAboutYourInnovation-innovator-answered"]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPrivateNotansweredClaimedInnovatorAboutYourInnovation(medigyAuthServicePolicies, answerStatus, "{{ $vendorId}}", session, visible=[".privateAboutYourInnovation-innovator-notAnswered"], hidden=[".publicAboutYourInnovation-notAnswer",".publicAboutYourInnovation",".publicAboutYourInnovation-answered",".privateAboutYourInnovation-claimed-notAnswered",".privateAboutYourInnovation-answered-claimed",".privateAboutYourInnovation-notAnswered-notClaimed",".privateAboutYourInnovation-innovator-answered"]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPrivateAnsweredInnovatorAboutYourInnovation(medigyAuthServicePolicies, answerStatus, "{{ $vendorId}}","{{ .questionCode}}", session, visible=[".privateAboutYourInnovation-innovator-answered"], hidden=[".publicAboutYourInnovation-notAnswer",".publicAboutYourInnovation",".publicAboutYourInnovation-answered",".privateAboutYourInnovation-innovator-notAnswered",".privateAboutYourInnovation-claimed-notAnswered",".privateAboutYourInnovation-answered-claimed",".privateAboutYourInnovation-notAnswered-notClaimed"]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPrivateNotansweredClaimedNotinnovatorAboutYourInnovation(medigyAuthServicePolicies, answerStatus,"{{ $claimStatus}}", "{{ $vendorId}}", session, visible=[".privateAboutYourInnovation-claimed-notAnswered"], hidden=[".publicAboutYourInnovation-notAnswer",".publicAboutYourInnovation",".publicAboutYourInnovation-answered",".privateAboutYourInnovation-innovator-answered", ".privateAboutYourInnovation-innovator-notAnswered",".privateAboutYourInnovation-answered-claimed",".privateAboutYourInnovation-notAnswered-notClaimed"], disableData=["#input{{ .questionCode }}"], addClassData=[]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPrivateAnsweredNotinnovatorAboutYourInnovation(medigyAuthServicePolicies, answerStatus, "{{ $vendorId}}", "{{ .questionCode}}",session, visible=[".privateAboutYourInnovation-answered-claimed"], hidden=[".publicAboutYourInnovation-notAnswer", ".publicAboutYourInnovation",".publicAboutYourInnovation-answered",".privateAboutYourInnovation-innovator-answered",".privateAboutYourInnovation-innovator-notAnswered",".privateAboutYourInnovation-claimed-notAnswered", ".privateAboutYourInnovation-notAnswered-notClaimed", ".innovator-question"]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPrivateNotansweredNotclaimedAboutYourInnovation(medigyAuthServicePolicies, answerStatus,"{{ $claimStatus}}", session, visible=[".privateAboutYourInnovation-notAnswered-notClaimed"], hidden=[".publicAboutYourInnovation-notAnswer",".publicAboutYourInnovation",".publicAboutYourInnovation-answered",".privateAboutYourInnovation-innovator-answered",".privateAboutYourInnovation-innovator-notAnswered",".privateAboutYourInnovation-claimed-notAnswered",".privateAboutYourInnovation-answered-claimed"],disableData=["#input{{ .questionCode }}"]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPublicNotclaimedAboutYourInnovation(medigyAuthServicePolicies, "{{ $claimStatus}}", session, disableData=["#input{{ .questionCode }}"], addClassData=[]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanNotansweredClaimedNotinnovatorAboutYourInnovation(medigyAuthServicePolicies, answerStatus,"{{ $claimStatus}}", "{{ $vendorId}}", session,  disableData=["#input{{ .questionCode }}"]);

            setTimeout(function(){
              medigyAuthServiceActions.makeVisibleIfQuestionNoneAnswerNoneAboutYourInnovation(".answer-{{ .questionCode}}", ".question-{{ .questionCode}}");

            }, 2000);
        medigyAuthServiceActions.makeVisibleIfNotAnswered("#answerStatus", hidden=["#icon-answered-date-{{ .questionCode}}"]);      
            
            
            
      });
  
      $('.field{{ .questionCode }}, .edit-field{{ .questionCode }}').keyup(function(){
        ($('#input{{ .questionCode }}').val()!= '') ? $('#btn-{{ .questionCode }}').show() :  $('#btn-{{ .questionCode }}').hide();
        ($('#edit-input{{ .questionCode }}').val()!= '') ? $('#edit-submit-btn-{{ .questionCode }}').show() : $('#edit-submit-btn-{{ .questionCode }}').hide();      
      });

      $('#btn-{{ .questionCode }}, #edit-submit-btn-{{ .questionCode }}').on("click", function (e) {
        e.preventDefault();
        var timestamp = Date.now();
        var userEmail = getCookie('userEmail');
        var product_Name = $(this).attr('data-title');
        var addUpdateStatus = ($(this).attr('data-action')) ? $(this).attr('data-action') : "Add";
        var updatedPerson = getCookie('firstname')+" "+getCookie('lastname');     
        gtmAddproduct(product_Name,userEmail);     
        if (getCookie('personid') != null && getCookie('sessionId')!= null && getCookie('sessionId')!= '' ) {
          var institutionId = $(this).attr('productid');
          var source = "hospital-compare-"+institutionId;
          var personId = getCookie('personid');
          var inputvalue = ($('#edit-input{{ .questionCode }}').val()) ? $('#edit-input{{ .questionCode }}').val() : $('#input{{ .questionCode }}').val();
          updatedDate = new Date(timestamp);
          var months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
          var currentMonth= months[updatedDate.getMonth()];
          var date = updatedDate.getDate();
          var year = updatedDate.getFullYear(); 
          var answeredDate = currentMonth+" "+date+", "+year; 
          var metricName ="medigy_qual_exp_institution_inno_"+$(this).attr('data-metric');
          if(validateFunction(inputvalue)==true )  {
            alert("Please fill the field properly");
            return false;
          }            
          var settings = {
            "async": true,
            "crossDomain": true,
            "url": "{{ $.Site.Params.GraphQLUrl }}",
            "method": "POST",
            "headers": {
              "Content-Type": "application/x-www-form-urlencoded",
              "Accept": "*/*",
              "Cache-Control": "no-cache",
              "Connection": "keep-alive"
            },
            "data": {
              "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"institutionId\", \n        value: \""+institutionId+"\"\n     }, \n      {\n        key: \"updatedPerson\", \n        value: \""+updatedPerson+"\"\n      }, \n      {\n        key: \"addUpdateStatus\", \n        value: \""+addUpdateStatus+"\"\n      }, \n      {\n        key: \"inputvalue\", \n        value: \""+inputvalue+"\"\n      }, \n      {\n        key: \"updatedDate\", \n        value: \""+updatedDate+"\"\n      }, \n      {\n        key: \"source\", \n        value: \""+source+"\"\n      },  \n     {\n        key: \"userId\", \n        value: \""+personId+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+metricName+"\", \n    metricName: \""+metricName+"\") {\n    status\n    message\n    errorCode\n  }\n}"
            }
          }
          $.ajax(settings).done(function (response) {                
            if(response.data.addPrometheusData.status == "SUCCESS"){                   
              $("#text-{{ .questionCode}}").text("{{.defaultAnswer}}"+" "+inputvalue); 
              $("#btn-{{ .questionCode}}").hide();
              $(".field{{ .questionCode}}").hide();
              $("#question-updated-on-{{ .questionCode}}").text("Updated on "+answeredDate+ " by Senior Executive at "+ {{ $instName}});   
              $("#edit-badge-{{ .questionCode}}").hide();
              $("#edit-submit-btn-{{ .questionCode}}").hide();
              $("#edit-input{{ .questionCode}}").val("");
            }
          });
        }
        else{
          if (getCookie('personid') == null)
          $('#loginModalCenter').modal('toggle');
          else
          $('#reLoginModalCenter').modal('toggle');
        }
      });

      function is_url(str) {
          regexp = /^(?:(?:https?):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/;
          if (regexp.test(str)) {
            return true;
          }
          else
            return false;
      }

      function validateFunction(string) {
        let isEmpty=true;
        var alphabet = 'abcdefghijklmnopqrstuvwxyz0123456789'.split('');
        alphabet.forEach((key,val)=>{
              if(string.indexOf(key) > -1) isEmpty=false;
            });     
        return isEmpty;
      }

      /// Endorse Button case
      /// Get data on page load starts here ////
        var metricName =  "medigy_qual_exp_institution_inno_answer_{{ .localQuestionCode}}"; 
        var institutionId = "{{ $instId }}";
        var settings = {
          "async": true,
          "crossDomain": true,
          "url": "{{ $.Site.Params.GraphQLUrl }}",
          "method": "POST",
          "headers": {
            "Content-Type": "application/x-www-form-urlencoded",
            "Accept": "*/*",
            "Cache-Control": "no-cache",
            "Connection": "keep-alive"
          },
          "data": {
            "query": "query{\n  getPromData(metricName:\""+ metricName +"\",metricQuery:\"{institutionId=\\\""+institutionId+"\\\"}[1y]\",groupByParam:[\"userId\",\"institutionId\"]){\n    prometheusData\n    status\n  }\n}"
          }
        } 
        $.ajax(settings).done(function (response) {
          if(response.data.getPromData.status == "success"){
            var JSONData = JSON.parse(response.data.getPromData.prometheusData);
            var userArray = JSONData.filter(function (el) {
              return el.userId == getCookie('personid')
            });
            if(JSONData.length > 0){
                var yescount=0;
                var nocount=0;
                for(i =0; i< (JSONData.length);i++)
                {
                  if(JSONData[i]['selectedVal'] == "1")
                    yescount++;  
                  else if (JSONData[i]['selectedVal'] == "0")
                    nocount++;                   
                }
                $('#{{ .questionCode }}-agree-count').html(yescount);
                $('#{{ .questionCode }}-disagree-count').html(nocount);
                for(var i=0; i<userArray.length; i++){		
                  if (userArray[i].userId == getCookie('personid')){
                    if(JSONData[i]['selectedVal'] == "1")
                    $('#agree-{{ .questionCode}}').prop('disabled', true);
                    else
                    $('#disagree-{{ .questionCode}}').prop('disabled', true);
                  }
                }
            }
          }
        });
      /// Get data ends here ////

      /// Endorse Push data starts here ////
        $("#agree-{{ .questionCode }}").on("click", function (e) {  
          $('#agree-{{ .questionCode}}').prop('disabled', true);
          var personid = getCookie('personid');
          var userEmail = getCookie('userEmail');
          var product_Name = $(this).attr('data-title');      
          gtmAddproduct(product_Name,userEmail); 
          if( personid != '' && personid != null && getCookie('sessionId')!= null && getCookie('sessionId')!= '' ) {         
            var timestamp = Date.now();
            var institutionId = $(this).attr('data-id');
            var source = "hospital-compare-"+institutionId;
            var selectedVal = "1";
            var metricName ="medigy_qual_exp_institution_inno_answer_"+$(this).attr('data-metric');
            var settings = {
              "async": true,
              "crossDomain": true,
              "url": "{{ $.Site.Params.GraphQLUrl }}",
              "method": "POST",
              "headers": {
                "Content-Type": "application/x-www-form-urlencoded",
                "Accept": "*/*",
                "Cache-Control": "no-cache",
                "Connection": "keep-alive"
              },
              "data": {
                "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"institutionId\", \n        value: \""+institutionId+"\"\n      }, \n      {\n        key: \"selectedVal\", \n        value: \""+selectedVal+"\"\n      }, \n      {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"createdat\", \n        value: \""+timestamp+"\"\n      }, \n      {\n        key: \"userId\", \n        value: \""+personid+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+ metricName +"\", \n    metricName: \""+metricName+"\") {\n    status\n    message\n    errorCode\n  }\n}"
              }
            }
            $.ajax(settings).done(function (response) {
              if(response.data.addPrometheusData.status == "SUCCESS"){
                var currentyescount=$('#{{ .questionCode }}-agree-count').html();
                currentyescount++;
                $('#{{ .questionCode }}-agree-count').html(currentyescount);
                var buttonstatus=   $('#disagree-{{ .questionCode}}').is(':disabled');              
                if(buttonstatus==true){
                  var currentnocount=$('#{{ .questionCode }}-disagree-count').html(); 
                  currentnocount=currentnocount-1;
                  $('#{{ .questionCode }}-disagree-count').html(currentnocount); 
                  $('#disagree-{{ .questionCode}}').prop('disabled', false);
                  $('#agree-{{ .questionCode}}').prop('disabled', true);
                }                   
              }          
            });
          }
          else{
            if (getCookie('personid') == null)
            $('#loginModalCenter').modal('toggle');
            else
            $('#reLoginModalCenter').modal('toggle');
          }
        });
      /// Endorse Push data ends here ////      
    </script>      
  {{ end }}
  {{ if eq .dataType "TX" }}
    <article class="yes-no-row inn-click "> 
      <form name="form{{ .questionCode }}" id="{{ .questionCode }}"  class="innovator-question question-{{ .questionCode}} ">
        <div class="row">
          <div class="col-md-6">
            <i class="{{ .prefix }} icon-position-1"></i><h4 id="text-{{ .questionCode}}" class="pl-5 normal-heading">{{ .question}}</h4>
          </div> 
           <div id="icon-answered-date-{{ .questionCode}}" class="col-md-4 ans-update-date icon-{{ .questionCode}}">
            <i class="far fa-clock icon-position-1"></i>
            <p id="question-updated-on-{{ .questionCode}}" class="pl-5"></p>
          </div>

          <div id="icon-answered-date-{{ .questionCode}}" class="col-md-2 ans-update-date icon-{{ .questionCode}} edit-{{ .questionCode}}" style="display:none;">
            <a class="update-btn-edit" id="edit-btn-{{ .questionCode}}" href="javascript:void(0)"><i class="far fa-edit icon-position-1"></i>
            <span id="question-updated-on-{{ .questionCode}}" class="pl-5">Edit</span></a>          
          </div>
          <!--Edit Badge section in innovator login screen starts-->
          <div class="alert alert-secondary innovator-edit-box" id="edit-badge-{{ .questionCode}}" style="display:none">
            <div class="row">
            <div class="col-md-6">
              <i class="{{ .prefix }} icon-position-1"></i><h4 id="text-{{ .questionCode}}" class="pl-5 normal-heading">{{ .question}}</h4>
            </div>  
            <div class="col-md-5">     
              <textarea class="form-control edit-field{{.questionCode}}" name="edit-input{{ .questionCode }}" id="edit-input{{ .questionCode }}"rows="2" cols="50" ></textarea>               
              <div class="text-left">
                <input type="submit" value="Submit" id="edit-submit-btn-{{ .questionCode }}" class="btn btn-primary q-btn-1 mt-2" data-action="update" data-title="{{ $instName }}" data-metric="{{ .localQuestionCode }}" productid="{{ $instId }}" style="display:none">
              </div>
            </div>
            <button type="button" class="close" id="close-btn-{{ .questionCode}}" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
            </div>
          </div>
          <!--Edit Badge section in innovator login screen ends-->
          <div class="col-md-6">
            <textarea class="form-control field{{.questionCode}}" name="input{{ .questionCode }}" id="input{{ .questionCode }}"rows="2" cols="50" ></textarea>               
            <div class="text-left">
              <input type="submit" value="Submit" id="btn-{{ .questionCode }}" class="btn btn-primary q-btn-1 mt-2" data-title="{{ $instName }}" data-metric="{{ .localQuestionCode }}" productid="{{ $instId }}" style="display:none">
            </div>
          </div>
        </div>
      </form>
      <div class="row innovator-answer answer-{{ .questionCode}} " style="display: none;">
        <div class="col-md-6">
          <div class="icon-space-left-1">
            <i class="{{ .prefix }} icon-position-1"></i>
            <h4 id="text-answer-{{ .questionCode}}" class="normal-heading"></h4>
          </div>
        </div>
        <div class="col-md-4 ans-update-date icon-{{ .questionCode}}" >
          <i class="far fa-clock icon-position-1"></i>
          <p id="answer-updated-on-{{ .questionCode}}" class="pl-5"></p>
        </div>
        <div id="btn-answer-{{ .questionCode}}" class="col-md-2 text-right">
          <button class="new-ofer-btn-1 yes btn white agree-btn" title="I Endorse that" id="agree-{{ .questionCode}}" type="button" data-title="{{ $instName }}" data-id="{{ $instId}}" data-metric="{{ .localQuestionCode}}">Endorse (<span class="" id="{{ .questionCode }}-agree-count">0</span>)</button>              
        </div>
      </div>
    </article>

    <script> 
      $('#edit-btn-{{ .questionCode}}').click(function(){
        $("#edit-badge-{{ .questionCode}}").show();
      });

      $('#close-btn-{{ .questionCode}}').click(function(){
        $("#edit-badge-{{ .questionCode}}").hide();
      });

      var institutionId = "{{ $instId }}";
      var metricName =  "medigy_qual_exp_institution_inno_{{ .localQuestionCode}}"; 
      var settings = {
      "async": true,
      "crossDomain": true,
      "url": "{{ $.Site.Params.GraphQLUrl }}",
      "method": "POST",
      "headers": {
        "Content-Type": "application/x-www-form-urlencoded",
        "Accept": "*/*",
        "Cache-Control": "no-cache",
        "Connection": "keep-alive"
      },
      "data": {
        "query": "query{ getPromData(metricName:\""+metricName+"\",metricQuery:\"{institutionId=\\\""+institutionId+"\\\"}[1y]\",groupByParam:[\"userId\",\"institutionId\"]){prometheusData   status}}"
          }
      }
      $.ajax(settings).done(function (Response) {  
        if(Response.data.getPromData.status == "success"){
          var JSONData = JSON.parse(Response.data.getPromData.prometheusData);  
          if(JSONData.length > 0 ){                       
            for(i =0; i< (JSONData.length);i++){ 
              timestamp = JSONData[i]['time'];       
              updatedDate = new Date(timestamp * 1000);
              var months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
              var currentMonth= months[updatedDate.getMonth()];
              var date = updatedDate.getDate();
              var year = updatedDate.getFullYear(); 
              var answeredDate = currentMonth+" "+date+", "+year;             
              var labelStatus = "Answered on ";
              if(JSONData[i]['addUpdateStatus'])
                (JSONData[i]['addUpdateStatus']=="update") ? labelStatus= "Updated on " : labelStatus = "Answered on ";          
              $("#text-{{ .questionCode}}").text("{{.defaultAnswer}}"+" "+JSONData[i]['inputvalue']);
              $("#btn-{{ .questionCode}}").hide();
              $(".field{{ .questionCode}}").hide();  
              $("#text-answer-{{ .questionCode}}").text("{{.defaultAnswer}}"+" "+JSONData[i]['inputvalue']);                                                           		                                                    
              $("#answer-updated-on-{{ .questionCode}}").text(labelStatus+answeredDate+ " by Senior Executive at "+ {{ $instName}});
              $("#question-updated-on-{{ .questionCode}}").text(labelStatus+answeredDate+ " by Senior Executive at "+ {{ $instName}});
            }   
            $('#answerStatus').val(1);
            if(getCookie('personid') != null && $('#answerStatus').val() ==1 && {{ $claimStatus}} == true && getCookie('personid') != "{{ $vendorId}}")
              $(".answer-{{ .questionCode}}").show(); 

          }
          else
            $('#answerStatus').val(0);
        }
            var answerStatus = $('#answerStatus').val();
            var session = {"personId":getCookie('personid'),"sessionId":getCookie('sessionId'),"sessionUser":getCookie('firstname')};
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPublicAnsweredAboutYourInnovation(medigyAuthServicePolicies, answerStatus, session, visible=[".publicAboutYourInnovation-answered"], hidden=[".publicAboutYourInnovation-notAnswer",".publicAboutYourInnovation",".privateAboutYourInnovation-innovator-notAnswered",".privateAboutYourInnovation-claimed-notAnswered",".privateAboutYourInnovation-answered-claimed",".privateAboutYourInnovation-notAnswered-notClaimed",".privateAboutYourInnovation-innovator-answered"]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPrivateNotansweredClaimedInnovatorAboutYourInnovation(medigyAuthServicePolicies, answerStatus, "{{ $vendorId}}", session, visible=[".privateAboutYourInnovation-innovator-notAnswered"], hidden=[".publicAboutYourInnovation-notAnswer",".publicAboutYourInnovation",".publicAboutYourInnovation-answered",".privateAboutYourInnovation-claimed-notAnswered",".privateAboutYourInnovation-answered-claimed",".privateAboutYourInnovation-notAnswered-notClaimed",".privateAboutYourInnovation-innovator-answered"]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPrivateAnsweredInnovatorAboutYourInnovation(medigyAuthServicePolicies, answerStatus, "{{ $vendorId}}","{{ .questionCode}}", session, visible=[".privateAboutYourInnovation-innovator-answered"], hidden=[".publicAboutYourInnovation-notAnswer",".publicAboutYourInnovation",".publicAboutYourInnovation-answered",".privateAboutYourInnovation-innovator-notAnswered",".privateAboutYourInnovation-claimed-notAnswered",".privateAboutYourInnovation-answered-claimed",".privateAboutYourInnovation-notAnswered-notClaimed"]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPrivateNotansweredClaimedNotinnovatorAboutYourInnovation(medigyAuthServicePolicies, answerStatus,"{{ $claimStatus}}", "{{ $vendorId}}", session, visible=[".privateAboutYourInnovation-claimed-notAnswered"], hidden=[".publicAboutYourInnovation-notAnswer",".publicAboutYourInnovation",".publicAboutYourInnovation-answered",".privateAboutYourInnovation-innovator-answered", ".privateAboutYourInnovation-innovator-notAnswered",".privateAboutYourInnovation-answered-claimed",".privateAboutYourInnovation-notAnswered-notClaimed"], disableData=["#input{{ .questionCode }}"], addClassData=[]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPrivateAnsweredNotinnovatorAboutYourInnovation(medigyAuthServicePolicies, answerStatus, "{{ $vendorId}}", "{{ .questionCode}}",session, visible=[".privateAboutYourInnovation-answered-claimed"], hidden=[".publicAboutYourInnovation-notAnswer", ".publicAboutYourInnovation",".publicAboutYourInnovation-answered",".privateAboutYourInnovation-innovator-answered",".privateAboutYourInnovation-innovator-notAnswered",".privateAboutYourInnovation-claimed-notAnswered", ".privateAboutYourInnovation-notAnswered-notClaimed", ".innovator-question"]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPrivateNotansweredNotclaimedAboutYourInnovation(medigyAuthServicePolicies, answerStatus,"{{ $claimStatus}}", session, visible=[".privateAboutYourInnovation-notAnswered-notClaimed"], hidden=[".publicAboutYourInnovation-notAnswer",".publicAboutYourInnovation",".publicAboutYourInnovation-answered",".privateAboutYourInnovation-innovator-answered",".privateAboutYourInnovation-innovator-notAnswered",".privateAboutYourInnovation-claimed-notAnswered",".privateAboutYourInnovation-answered-claimed"], disableData=["#input{{ .questionCode }}"]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanPublicNotclaimedAboutYourInnovation(medigyAuthServicePolicies, "{{ $claimStatus}}", session, disableData=["#input{{ .questionCode }}"], addClassData=[]);
            medigyAuthServiceActions.makeVisibleIfActiveUserCanNotansweredClaimedNotinnovatorAboutYourInnovation(medigyAuthServicePolicies, answerStatus,"{{ $claimStatus}}", "{{ $vendorId}}", session,  disableData=["#input{{ .questionCode }}"]);
       
            setTimeout(function(){
              medigyAuthServiceActions.makeVisibleIfQuestionNoneAnswerNoneAboutYourInnovation(".answer-{{ .questionCode}}", ".question-{{ .questionCode}}");

            }, 2000);
        medigyAuthServiceActions.makeVisibleIfNotAnswered("#answerStatus", hidden=["#icon-answered-date-{{ .questionCode}}"]);      

      });
     
      $('.field{{ .questionCode }}, .edit-field{{ .questionCode }}').keyup(function(){
        ($('#input{{ .questionCode }}').val()!= '') ? $('#btn-{{ .questionCode }}').show() :  $('#btn-{{ .questionCode }}').hide();
        ($('#edit-input{{ .questionCode }}').val()!= '') ? $('#edit-submit-btn-{{ .questionCode }}').show() : $('#edit-submit-btn-{{ .questionCode }}').hide();      
      });

      $('#btn-{{ .questionCode }}, #edit-submit-btn-{{ .questionCode }}').on("click", function (e) {
        e.preventDefault();
        var userEmail = getCookie('userEmail');
        var product_Name = $(this).attr('data-title');
        var addUpdateStatus = ($(this).attr('data-action')) ? $(this).attr('data-action') : "Add";
        var updatedPerson = getCookie('firstname')+" "+getCookie('lastname');           
        gtmAddproduct(product_Name,userEmail);     
        if (getCookie('personid') != null && getCookie('sessionId')!= null && getCookie('sessionId')!= '' ) {
          var institutionId = $(this).attr('productid');
          var source = "hospital-compare-"+institutionId;
          var personId = getCookie('personid');
          var inputvalue = ($('#edit-input{{ .questionCode }}').val()) ? $('#edit-input{{ .questionCode }}').val() : $('#input{{ .questionCode }}').val();
          updatedDate = new Date(timestamp);
          var months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
          var currentMonth= months[updatedDate.getMonth()];
          var date = updatedDate.getDate();
          var year = updatedDate.getFullYear(); 
          var answeredDate = currentMonth+" "+date+", "+year;
          var metricName ="medigy_qual_exp_institution_inno_"+$(this).attr('data-metric');
          if(validateFunction(inputvalue)==true )  {
            alert("Please fill the field properly");
            return false;
          } 
          var settings = {
            "async": true,
            "crossDomain": true,
            "url": "{{ $.Site.Params.GraphQLUrl }}",
            "method": "POST",
            "headers": {
              "Content-Type": "application/x-www-form-urlencoded",
              "Accept": "*/*",
              "Cache-Control": "no-cache",
              "Connection": "keep-alive"
            },
            "data": {
              "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"institutionId\", \n        value: \""+institutionId+"\"\n     }, \n      {\n        key: \"updatedPerson\", \n        value: \""+updatedPerson+"\"\n      }, \n      {\n        key: \"addUpdateStatus\", \n        value: \""+addUpdateStatus+"\"\n      }, \n      {\n        key: \"updatedDate\", \n        value: \""+updatedDate+"\"\n      }, \n      {\n        key: \"inputvalue\", \n        value: \""+inputvalue+"\"\n      }, \n      {\n        key: \"source\", \n        value: \""+source+"\"\n      },  \n     {\n        key: \"userId\", \n        value: \""+personId+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+metricName+"\", \n    metricName: \""+metricName+"\") {\n    status\n    message\n    errorCode\n  }\n}"
            }
          }
          $.ajax(settings).done(function (response) {                
            if(response.data.addPrometheusData.status == "SUCCESS")
            {                   
              $("#text-{{ .questionCode}}").text("{{.defaultAnswer}}"+" "+inputvalue);
              $("#btn-{{ .questionCode}}").hide();
              $(".field{{ .questionCode}}").hide();
              $("#question-updated-on-{{ .questionCode}}").text("Updated on "+answeredDate+ " by Senior Executive at "+ {{ $instName}});   
              $("#edit-badge-{{ .questionCode}}").hide();
              $("#edit-submit-btn-{{ .questionCode}}").hide();
              $("#edit-input{{ .questionCode}}").val("");
            }
          });
        }
        else
        {
          if (getCookie('personid') == null)
          $('#loginModalCenter').modal('toggle');
          else
          $('#reLoginModalCenter').modal('toggle');
        }
      });

      function is_url(str) {
          regexp = /^(?:(?:https?):\/\/)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/\S*)?$/;
          if (regexp.test(str)) {
            return true;
          }
          else
            return false;
      }

      function validateFunction(string) {
        let isEmpty=true;
        var alphabet = 'abcdefghijklmnopqrstuvwxyz0123456789'.split('');
        alphabet.forEach((key,val)=>{
              if(string.indexOf(key) > -1) isEmpty=false;
            });        
        return isEmpty;
      }

      /// Endorse Button case
      /// Get data on page load starts here ////
        var metricName =  "medigy_qual_exp_institution_inno_answer_{{ .localQuestionCode}}"; 
        var institutionId = "{{ $instId }}";
        var settings = {
          "async": true,
          "crossDomain": true,
          "url": "{{ $.Site.Params.GraphQLUrl }}",
          "method": "POST",
          "headers": {
            "Content-Type": "application/x-www-form-urlencoded",
            "Accept": "*/*",
            "Cache-Control": "no-cache",
            "Connection": "keep-alive"
          },
          "data": {
            "query": "query{\n  getPromData(metricName:\""+ metricName +"\",metricQuery:\"{institutionId=\\\""+institutionId+"\\\"}[1y]\",groupByParam:[\"userId\",\"institutionId\"]){\n    prometheusData\n    status\n  }\n}"
          }
        } 
        $.ajax(settings).done(function (response) {
          if(response.data.getPromData.status == "success"){
            var JSONData = JSON.parse(response.data.getPromData.prometheusData);
            var userArray = JSONData.filter(function (el) {
            return el.userId == getCookie('personid')
            });
            if(JSONData.length > 0){
              var yescount=0;
              var nocount=0;
              for(i =0; i< (JSONData.length);i++)
              {
                if(JSONData[i]['selectedVal'] == "1")
                  yescount++;  
                else if (JSONData[i]['selectedVal'] == "0")
                  nocount++;                   
              }
              $('#{{ .questionCode }}-agree-count').html(yescount);
              $('#{{ .questionCode }}-disagree-count').html(nocount);
              for(var i=0; i<userArray.length; i++){		
                if (userArray[i].userId == getCookie('personid')){
                  if(JSONData[i]['selectedVal'] == "1")
                  $('#agree-{{ .questionCode}}').prop('disabled', true);
                  else
                  $('#disagree-{{ .questionCode}}').prop('disabled', true);
                }
              }
            }
          }
        });
      /// Get data ends here ////
      /// Endorse Push data starts here ////
        $("#agree-{{ .questionCode }}").on("click", function (e) {  
        $('#agree-{{ .questionCode}}').prop('disabled', true);
        var personid = getCookie('personid');
        var userEmail = getCookie('userEmail');
        var product_Name = $(this).attr('data-title');      
        gtmAddproduct(product_Name,userEmail); 
        if( personid != '' && personid != null && getCookie('sessionId')!= null && getCookie('sessionId')!= '' ) {         
          var timestamp = Date.now();
          var institutionId = $(this).attr('data-id');
          var source = "hospital-compare-"+institutionId;
          var selectedVal = "1";
          var metricName ="medigy_qual_exp_institution_inno_answer_"+$(this).attr('data-metric');
          var settings = {
            "async": true,
            "crossDomain": true,
            "url": "{{ $.Site.Params.GraphQLUrl }}",
            "method": "POST",
            "headers": {
              "Content-Type": "application/x-www-form-urlencoded",
              "Accept": "*/*",
              "Cache-Control": "no-cache",
              "Connection": "keep-alive"
            },
            "data": {
              "query": "mutation {\n  addPrometheusData(\n    metricData: [\n    \t{\n        key: \"institutionId\", \n        value: \""+institutionId+"\"\n      }, \n      {\n        key: \"selectedVal\", \n        value: \""+selectedVal+"\"\n      }, \n      {\n        key: \"source\", \n        value: \""+source+"\"\n      }, \n      {\n        key: \"createdat\", \n        value: \""+timestamp+"\"\n      }, \n      {\n        key: \"userId\", \n        value: \""+personid+"\"\n      }\n    ], \n    pushGatewayPort: \"\", \n    prometheusJobName: \""+ metricName +"\", \n    metricName: \""+metricName+"\") {\n    status\n    message\n    errorCode\n  }\n}"
            }
          }
          $.ajax(settings).done(function (response) {
            if(response.data.addPrometheusData.status == "SUCCESS"){
              var currentyescount=$('#{{ .questionCode }}-agree-count').html();
              currentyescount++;
              $('#{{ .questionCode }}-agree-count').html(currentyescount);
              var buttonstatus=   $('#disagree-{{ .questionCode}}').is(':disabled');              
              if(buttonstatus==true){
                var currentnocount=$('#{{ .questionCode }}-disagree-count').html(); 
                currentnocount=currentnocount-1;
                $('#{{ .questionCode }}-disagree-count').html(currentnocount); 
                $('#disagree-{{ .questionCode}}').prop('disabled', false);
                $('#agree-{{ .questionCode}}').prop('disabled', true);
              }                  
            }          
          });
        }
        else{
          if (getCookie('personid') == null)
          $('#loginModalCenter').modal('toggle');
          else
          $('#reLoginModalCenter').modal('toggle');
        }
      });
      /// Endorse Push data ends here ////   
    </script>     
  {{ end }} 
  {{ end }}
{{ end }}